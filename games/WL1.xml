<?xml version="1.0" encoding="utf-8" ?>
<Game Name="Wolfenstein 3-D Shareware" Version="1.4" Path="WL1" Exe="WOLF3D.EXE" HighScores="CONFIG.WL1">
	<VgaGraph VgaDict="VGADICT.WL1" VgaGraph="VGAGRAPH.WL1" VgaHead="VGAHEAD.WL1" LoadingPic="GETPSYCHEDPIC">
		<Sizes Chunk="0" StartFont="1" StartPic="3" />
		<Font Number="0" Name="SMALL" />
		<Font Number="1" Name="BIG" />
		<Font Prefix="L_" Name="L" SpaceColor="127" SpaceWidth="16" />
		<Font Prefix="N_" Name="N" />
		<Pic Number="0" Name="H_BJPIC" />
		<Pic Number="1" Name="H_CASTLEPIC" />
		<Pic Number="2" Name="H_KEYBOARDPIC" />
		<Pic Number="3" Name="H_JOYPIC" />
		<Pic Number="4" Name="H_HEALPIC" />
		<Pic Number="5" Name="H_TREASUREPIC" />
		<Pic Number="6" Name="H_GUNPIC" />
		<Pic Number="7" Name="H_KEYPIC" />
		<Pic Number="8" Name="H_BLAZEPIC" />
		<Pic Number="9" Name="H_WEAPON1234PIC" />
		<Pic Number="10" Name="H_WOLFLOGOPIC" />
		<Pic Number="11" Name="H_VISAPIC" />
		<Pic Number="12" Name="H_MCPIC" />
		<Pic Number="13" Name="H_IDLOGOPIC" />
		<Pic Number="14" Name="H_TOPWINDOWPIC" />
		<Pic Number="15" Name="H_LEFTWINDOWPIC" />
		<Pic Number="16" Name="H_RIGHTWINDOWPIC" />
		<Pic Number="17" Name="H_BOTTOMINFOPIC" />
		<Pic Number="18" Name="H_SPEARADPIC" />
		<Pic Number="19" Name="C_OPTIONSPIC" />
		<Pic Number="20" Name="C_CURSOR1PIC" />
		<Pic Number="21" Name="C_CURSOR2PIC" />
		<Pic Number="22" Name="C_NOTSELECTEDPIC" />
		<Pic Number="23" Name="C_SELECTEDPIC" />
		<Pic Number="24" Name="C_FXTITLEPIC" />
		<Pic Number="25" Name="C_DIGITITLEPIC" />
		<Pic Number="26" Name="C_MUSICTITLEPIC" />
		<Pic Number="27" Name="C_MOUSELBACKPIC" />
		<Pic Number="28" Name="C_BABYMODEPIC" />
		<Pic Number="29" Name="C_EASYPIC" />
		<Pic Number="30" Name="C_NORMALPIC" />
		<Pic Number="31" Name="C_HARDPIC" />
		<Pic Number="32" Name="C_LOADSAVEDISKPIC" />
		<Pic Number="33" Name="C_DISKLOADING1PIC" />
		<Pic Number="34" Name="C_DISKLOADING2PIC" />
		<Pic Number="35" Name="C_CONTROLPIC" />
		<Pic Number="36" Name="C_CUSTOMIZEPIC" />
		<Pic Number="37" Name="C_LOADGAMEPIC" />
		<Pic Number="38" Name="C_SAVEGAMEPIC" />
		<Pic Number="39" Name="C_EPISODE1PIC" />
		<Pic Number="40" Name="C_EPISODE2PIC" />
		<Pic Number="41" Name="C_EPISODE3PIC" />
		<Pic Number="42" Name="C_EPISODE4PIC" />
		<Pic Number="43" Name="C_EPISODE5PIC" />
		<Pic Number="44" Name="C_EPISODE6PIC" />
		<Pic Number="45" Name="C_CODEPIC" />
		<Pic Number="46" Name="C_TIMECODEPIC" />
		<Pic Number="47" Name="C_LEVELPIC" />
		<Pic Number="48" Name="C_NAMEPIC" />
		<Pic Number="49" Name="C_SCOREPIC" />
		<Pic Number="50" Name="C_JOY1PIC" />
		<Pic Number="51" Name="C_JOY2PIC" />
		<Pic Number="52" Name="L_GUYPIC" />
		<Pic Number="53" Character=":" Name="L_COLONPIC" />
		<Pic Number="54" Character="0" Name="L_NUM0PIC" />
		<Pic Number="55" Character="1" Name="L_NUM1PIC" />
		<Pic Number="56" Character="2" Name="L_NUM2PIC" />
		<Pic Number="57" Character="3" Name="L_NUM3PIC" />
		<Pic Number="58" Character="4" Name="L_NUM4PIC" />
		<Pic Number="59" Character="5" Name="L_NUM5PIC" />
		<Pic Number="60" Character="6" Name="L_NUM6PIC" />
		<Pic Number="61" Character="7" Name="L_NUM7PIC" />
		<Pic Number="62" Character="8" Name="L_NUM8PIC" />
		<Pic Number="63" Character="9" Name="L_NUM9PIC" />
		<Pic Number="64" Character="%" Name="L_PERCENTPIC" />
		<Pic Number="65" Character="A" Name="L_APIC" />
		<Pic Number="66" Character="B" Name="L_BPIC" />
		<Pic Number="67" Character="C" Name="L_CPIC" />
		<Pic Number="68" Character="D" Name="L_DPIC" />
		<Pic Number="69" Character="E" Name="L_EPIC" />
		<Pic Number="70" Character="F" Name="L_FPIC" />
		<Pic Number="71" Character="G" Name="L_GPIC" />
		<Pic Number="72" Character="H" Name="L_HPIC" />
		<Pic Number="73" Character="I" Name="L_IPIC" />
		<Pic Number="74" Character="J" Name="L_JPIC" />
		<Pic Number="75" Character="K" Name="L_KPIC" />
		<Pic Number="76" Character="L" Name="L_LPIC" />
		<Pic Number="77" Character="M" Name="L_MPIC" />
		<Pic Number="78" Character="N" Name="L_NPIC" />
		<Pic Number="79" Character="O" Name="L_OPIC" />
		<Pic Number="80" Character="P" Name="L_PPIC" />
		<Pic Number="81" Character="Q" Name="L_QPIC" />
		<Pic Number="82" Character="R" Name="L_RPIC" />
		<Pic Number="83" Character="S" Name="L_SPIC" />
		<Pic Number="84" Character="T" Name="L_TPIC" />
		<Pic Number="85" Character="U" Name="L_UPIC" />
		<Pic Number="86" Character="V" Name="L_VPIC" />
		<Pic Number="87" Character="W" Name="L_WPIC" />
		<Pic Number="88" Character="X" Name="L_XPIC" />
		<Pic Number="89" Character="Y" Name="L_YPIC" />
		<Pic Number="90" Character="Z" Name="L_ZPIC" />
		<Pic Number="91" Character="!" Name="L_EXPOINTPIC" />
		<Pic Number="92" Character="'" Name="L_APOSTROPHEPIC" />
		<Pic Number="93" Name="L_GUY2PIC" />
		<Pic Number="94" Name="L_BJWINSPIC" />
		<Pic Number="95" Name="STATUSBARPIC" />
		<Pic Number="96" Name="TITLEPIC" />
		<Pic Number="97" Name="PG13PIC" />
		<Pic Number="98" Name="CREDITSPIC" />
		<Pic Number="99" Name="HIGHSCORESPIC" />
		<Pic Number="100" Name="KNIFEPIC" />
		<Pic Number="101" Name="GUNPIC" />
		<Pic Number="102" Name="MACHINEGUNPIC" />
		<Pic Number="103" Name="GATLINGGUNPIC" />
		<Pic Number="104" Name="NOKEYPIC" />
		<Pic Number="105" Name="GOLDKEYPIC" />
		<Pic Number="106" Name="SILVERKEYPIC" />
		<Pic Number="107" Character=" " Name="N_BLANKPIC" />
		<Pic Number="108" Character="0" Name="N_0PIC" />
		<Pic Number="109" Character="1" Name="N_1PIC" />
		<Pic Number="110" Character="2" Name="N_2PIC" />
		<Pic Number="111" Character="3" Name="N_3PIC" />
		<Pic Number="112" Character="4" Name="N_4PIC" />
		<Pic Number="113" Character="5" Name="N_5PIC" />
		<Pic Number="114" Character="6" Name="N_6PIC" />
		<Pic Number="115" Character="7" Name="N_7PIC" />
		<Pic Number="116" Character="8" Name="N_8PIC" />
		<Pic Number="117" Character="9" Name="N_9PIC" />
		<Pic Number="118" Name="FACE1APIC" />
		<Pic Number="119" Name="FACE1BPIC" />
		<Pic Number="120" Name="FACE1CPIC" />
		<Pic Number="121" Name="FACE2APIC" />
		<Pic Number="122" Name="FACE2BPIC" />
		<Pic Number="123" Name="FACE2CPIC" />
		<Pic Number="124" Name="FACE3APIC" />
		<Pic Number="125" Name="FACE3BPIC" />
		<Pic Number="126" Name="FACE3CPIC" />
		<Pic Number="127" Name="FACE4APIC" />
		<Pic Number="128" Name="FACE4BPIC" />
		<Pic Number="129" Name="FACE4CPIC" />
		<Pic Number="130" Name="FACE5APIC" />
		<Pic Number="131" Name="FACE5BPIC" />
		<Pic Number="132" Name="FACE5CPIC" />
		<Pic Number="133" Name="FACE6APIC" />
		<Pic Number="134" Name="FACE6BPIC" />
		<Pic Number="135" Name="FACE6CPIC" />
		<Pic Number="136" Name="FACE7APIC" />
		<Pic Number="137" Name="FACE7BPIC" />
		<Pic Number="138" Name="FACE7CPIC" />
		<Pic Number="139" Name="FACE8APIC" />
		<Pic Number="140" Name="GOTGATLINGPIC" />
		<Pic Number="141" Name="MUTANTBJPIC" />
		<Pic Number="142" Name="PAUSEDPIC" />
		<Pic Number="143" Name="GETPSYCHEDPIC" />
		<StatusBar Pic="STATUSBARPIC" Font="3" >
			<Number Name="Difficulty" Init="1" />
			<Number Name="Episode" Init="1" />
			<Number Name="Floor" X="32" Y="16" Digits="2" Init="1" />
			<Number Name="Score" X="96" Y="16" Digits="6" Init="0" />
			<Number Name="Lives" X="128" Y="16" Digits="2" Init="3" />
			<Face X="134" Y="5" />
			<Number Name="Health" X="192" Y="16" Digits="3" Init="100" Max="100" />
			<Number Name="Ammo" X="232" Y="16" Digits="2" Init="8" Max="99" />
			<Number Name="Gold Key" X="240" Y="4" Have="GOLDKEYPIC" Empty="NOKEYPIC" Init="0" LevelReset="0" />
			<Number Name="Silver Key" X="240" Y="20" Have="SILVERKEYPIC" Empty="NOKEYPIC" Init="0" LevelReset="0" />
			<Number Name="Weapon0" Init="1" Max="1" />
			<Number Name="Weapon1" Init="1" Max="1" />
			<Number Name="Weapon2" Init="0" Max="1" />
			<Number Name="Weapon3" Init="0" Max="1" />
			<Number Name="SelectedWeapon0" Init="1" />
			<Number Name="SelectedWeapon1" Init="1" />
			<Number Name="StatusBarWeapon" Init="1" />
			<Weapons X="256" Y="8">
				<Weapon Number="0" Pic="KNIFEPIC" Init="1" />
				<Weapon Number="1" Pic="GUNPIC" Init="1" />
				<Weapon Number="2" Pic="MACHINEGUNPIC" Init="0" />
				<Weapon Number="3" Pic="GATLINGGUNPIC" Init="0" />
			</Weapons>
		</StatusBar>
		<!-- WL_MENU.H default colors: TEXTCOLOR=23, HIGHLIGHT=19, BORDCOLOR=41, BKGDCOLOR=45, DEACTIVE=43, BORD2COLOR=35 -->
		<Menus Start="Main" TextColor="23" Highlight="19" BorderColor="41" BoxBackgroundColor="45" Deactive="43" Border2Color="35" Font="BIG" CursorPic="C_CURSOR1PIC" CursorMoveSound="MOVEGUN2SND" Music="WONDERIN_MUS">
			<!-- Main Menu (WL_MENU.H: MENU_X=76, MENU_Y=55, MainItems indent=24)
			     WL_MENU.C:DrawMainMenu - VWB_DrawPic(84,0,C_OPTIONSPIC)
			     WL_MENU.C:DrawMainMenu - VWB_DrawPic(112,184,C_MOUSELBACKPIC)
			     WL_MENU.C:DrawWindow(MENU_X-8,MENU_Y-3,MENU_W,MENU_H,BKGDCOLOR) = DrawWindow(68,52,178,136,45) -->
			<Menu Name="Main" X="76" Y="55" Indent="24" Spacing="13">
				<Picture Name="C_OPTIONSPIC" X="84" Y="0" Stripes="true" />
				<Picture Name="C_MOUSELBACKPIC" X="112" Y="184" />
				<Box X="68" Y="52" W="178" H="136" />
				<MenuItem Text="New Game">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("Episodes")
				</MenuItem>
				<MenuItem Text="Sound">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("Sound")
				</MenuItem>
				<MenuItem Text="Control">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("Control")
				</MenuItem>
				<MenuItem Text="Load Game">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("LoadGame")
				</MenuItem>
				<MenuItem Text="Save Game">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("SaveGame")
				</MenuItem>
				<MenuItem Text="Change View">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("ChangeView")
				</MenuItem>
				<MenuItem Text="View Scores">
					PlayAdLibSound('SHOOTSND')
					NavigateToMenu("ViewScores")
				</MenuItem>
				<MenuItem Text="Back to Demo" />
				<MenuItem Text="Quit">
					PlayAdLibSound('SHOOTSND')
					Quit()
				</MenuItem>
			</Menu>

			<!-- Episode Selection Menu (WL_MENU.H: NE_X=10, NE_Y=23) -->
			<!-- WL_MENU.C:1587: DrawNewEpisode() function -->
			<!-- WL_MENU.C:1597: DrawWindow(NE_X-4,NE_Y-4,NE_W+8,NE_H+8) = DrawWindow(6,19,308,162) -->
			<!-- WL_MENU.C:1612: Episode pictures at (NE_X+32,NE_Y+i*26) for i=0 to 5 -->
			<!-- WL_MENU.C:95: NewEitems={NE_X,NE_Y,11,0,88} - X=10, Y=23, indent=88 -->
			<Menu Name="Episodes" X="10" Y="23" Indent="88" Spacing="26">
				<Picture Name="C_MOUSELBACKPIC" X="112" Y="184" />
				<!-- WL_MENU.C:1597: DrawWindow(6,19,308,162) -->
				<Box X="6" Y="19" W="308" H="162" />
				<!-- WL_MENU.C:1599-1604: PrintY=2 (2 pixels from screen top), WindowX=0, US_CPrint centers horizontally -->
				<Text X="Center" Y="2" Color="71">Which episode to play?</Text>

				<!-- WL_MENU.C:1612: Episode pictures drawn at (NE_X+32,NE_Y+i*26) = (42, 23+i*26) -->
				<!-- Pictures must be above box (ZIndex > 7) to be visible -->
				<Picture Name="C_EPISODE1PIC" X="42" Y="23" ZIndex="9" />
				<Picture Name="C_EPISODE2PIC" X="42" Y="49" ZIndex="9" />
				<Picture Name="C_EPISODE3PIC" X="42" Y="75" ZIndex="9" />
				<Picture Name="C_EPISODE4PIC" X="42" Y="101" ZIndex="9" />
				<Picture Name="C_EPISODE5PIC" X="42" Y="127" ZIndex="9" />
				<Picture Name="C_EPISODE6PIC" X="42" Y="153" ZIndex="9" />

				<!-- WL_MENU.C:225-327: NewEmenu[] array with text AND pictures -->
				<!-- Pictures at X=42 (NE_X+32), menu text at X=98 (NE_X+indent = 10+88) -->
				<!-- Text has two lines per episode, changes color when selected -->
				<!-- Spacing=26 positions episodes at Y: 23, 49, 75, 101, 127, 153 (matching pictures) -->
				<!-- WL_MENU.C:295-296: Episode 1 active=1 for shareware -->
				<MenuItem Text="Episode 1&#10;Escape from Wolfenstein">
					PlayAdLibSound('SHOOTSND')
					SetEpisode(0)
					NavigateToMenu("NewGame")
				</MenuItem>
				<!-- WL_MENU.C:314-327: Episodes 2-6 with active=0 for WL1 shareware -->
				<!-- WL_MENU.C:1434-1441: When !EpisodeSelect[which/2], show ordering message -->
				<MenuItem Text="Episode 2&#10;Operation: Eisenfaust">
					PlayAdLibSound('NOWAYSND')
					ShowMessage('Please select "Read This!"\nfrom the Options menu to\nfind out how to order this\nepisode from Apogee.')
				</MenuItem>
				<MenuItem Text="Episode 3&#10;Die, Fuhrer, Die!">
					PlayAdLibSound('NOWAYSND')
					ShowMessage('Please select "Read This!"\nfrom the Options menu to\nfind out how to order this\nepisode from Apogee.')
				</MenuItem>
				<MenuItem Text="Episode 4&#10;A Dark Secret">
					PlayAdLibSound('NOWAYSND')
					ShowMessage('Please select "Read This!"\nfrom the Options menu to\nfind out how to order this\nepisode from Apogee.')
				</MenuItem>
				<MenuItem Text="Episode 5&#10;Trail of the Madman">
					PlayAdLibSound('NOWAYSND')
					ShowMessage('Please select "Read This!"\nfrom the Options menu to\nfind out how to order this\nepisode from Apogee.')
				</MenuItem>
				<MenuItem Text="Episode 6&#10;Confrontation">
					PlayAdLibSound('NOWAYSND')
					ShowMessage('Please select "Read This!"\nfrom the Options menu to\nfind out how to order this\nepisode from Apogee.')
				</MenuItem>
			</Menu>

			<!-- New Game / Difficulty Menu (WL_MENU.H: NM_X=50, NM_Y=100) -->
			<!-- WL_MENU.C:1654: DrawWindow(NM_X-5,NM_Y-10,NM_W,NM_H,BKGDCOLOR) where NM_W=225, NM_H=13*4+15=67 -->
			<!-- WL_MENU.C:1518: which=HandleMenu(&NewItems,&NewMenu[0],DrawNewGameDiff) -->
			<!-- WL_MENU.C:1669: void DrawNewGameDiff(int w) { VWB_DrawPic(NM_X+185,NM_Y+7,w+C_BABYMODEPIC); } -->
			<Menu Name="NewGame" X="50" Y="100" Indent="0" Spacing="13" CursorPic="">
				<!-- WL_MENU.C:1654: DrawWindow(NM_X-5,NM_Y-10,NM_W,NM_H) = (45,90,225,67) -->
				<Box X="45" Y="90" W="225" H="67" />
				<!-- WL_MENU.C:1639-1649: US_Print("How tough are you?") at (NM_X+20, NM_Y-32) = (70,68) with READHCOLOR = 0x47 = 71 -->
				<Text X="70" Y="68" Color="71">How tough are you?</Text>
				<!-- Difficulty face picture - updated dynamically by OnSelectionChanged (WL_MENU.C:1675) -->
				<!-- ZIndex=9 to draw ABOVE the box (boxes are ZIndex=7). Original: DrawNewGameDiff called AFTER DrawWindow -->
				<Picture Name="C_BABYMODEPIC" X="235" Y="107" ZIndex="9" />
				<Picture Name="C_MOUSELBACKPIC" X="112" Y="184" />
				<!-- OnSelectionChanged script: Updates difficulty picture based on selection (WL_MENU.C:1669) -->
				<OnSelectionChanged>
					<![CDATA[
-- Update the difficulty face picture (index 1) based on current selection
local index = GetSelectedIndex()
if index == 0 then
	SetPicture('C_BABYMODEPIC', 0)
elseif index == 1 then
	SetPicture('C_EASYPIC', 0)
elseif index == 2 then
	SetPicture('C_NORMALPIC', 0)
elseif index == 3 then
	SetPicture('C_HARDPIC', 0)
end
					]]>
				</OnSelectionChanged>
				<MenuItem Text="Can I play, Daddy?">
					SetDifficulty(0)
					SetStartGame(true)
				</MenuItem>
				<MenuItem Text="Don't hurt me.">
					SetDifficulty(1)
					SetStartGame(true)
				</MenuItem>
				<MenuItem Text="Bring 'em on!">
					SetDifficulty(2)
					SetStartGame(true)
				</MenuItem>
				<MenuItem Text="I am Death incarnate!">
					SetDifficulty(3)
					SetStartGame(true)
				</MenuItem>
			</Menu>

			<!-- Placeholder menus for testing navigation -->
<!-- Sound Menu (WL_MENU.H: SM_X=48, SM_Y1=20) -->
			<!-- WL_MENU.C:1820-1822: Three DrawWindow boxes for Sound FX, Digitized, Music sections -->
			<!-- WL_MENU.C:1852-1854: Title pictures at (100, SM_Yn-20) -->
			<!-- WL_MENU.C:1857-1898: Toggle switches drawn at (SM_X+24, SM_Y1+i*13+2) based on current settings -->
			<Menu Name="Sound" X="48" Y="20" Indent="52" Spacing="13">
				<!-- Three boxes for the three sections (WL_MENU.C:1820-1822) -->
				<!-- Box 1: Sound Effects at (SM_X-8, SM_Y1-3, SM_W, SM_H1) = (40, 17, 250, 45) -->
				<Box X="40" Y="17" W="250" H="45" />
				<!-- Box 2: Digitized Sound at (SM_X-8, SM_Y2-3, SM_W, SM_H2) = (40, 82, 250, 45) -->
				<Box X="40" Y="82" W="250" H="45" />
				<!-- Box 3: Music at (SM_X-8, SM_Y3-3, SM_W, SM_H3) = (40, 147, 250, 32) -->
				<Box X="40" Y="147" W="250" H="32" />

				<!-- Title pictures (WL_MENU.C:1852-1854) -->
				<Picture Name="C_FXTITLEPIC" X="100" Y="0" />
				<Picture Name="C_DIGITITLEPIC" X="100" Y="65" />
				<Picture Name="C_MUSICTITLEPIC" X="100" Y="130" />
				<Picture Name="C_MOUSELBACKPIC" X="112" Y="184" />

				<!-- Toggle switch pictures - 7 total (WL_MENU.C:1895-1897) -->
				<!-- Position: (SM_X+24, SM_Y1+i*13+2) = (72, 20+i*13+2) -->
				<!-- ZIndex=9 to draw above boxes (boxes are ZIndex=7) -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="22" ZIndex="9" />   <!-- Item 0: Sound FX None -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="35" ZIndex="9" />   <!-- Item 1: Sound FX PC -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="48" ZIndex="9" />   <!-- Item 2: Sound FX AdLib -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="87" ZIndex="9" />   <!-- Item 3: Digitized None -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="100" ZIndex="9" />  <!-- Item 4: Digitized SB -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="152" ZIndex="9" />  <!-- Item 5: Music None -->
				<Picture Name="C_NOTSELECTEDPIC" X="72" Y="165" ZIndex="9" />  <!-- Item 6: Music AdLib -->

				<!-- OnSelectionChanged: Update all toggle graphics based on current settings (WL_MENU.C:1868-1892) -->
				<OnSelectionChanged>
					<![CDATA[
-- Update all toggle switches to reflect current sound settings
-- Picture indices: 4-11 correspond to the 8 toggle switches (excluding spacers)
local soundMode = GetSoundMode()
local digiMode = GetDigiMode()
local musicEnabled = GetMusicEnabled()

-- Sound Effects toggles (items 0-2, picture indices 4-6)
if soundMode == "Off" then
	SetPicture('C_SELECTEDPIC', 4)
	SetPicture('C_NOTSELECTEDPIC', 5)
	SetPicture('C_NOTSELECTEDPIC', 6)
elseif soundMode == "PC" then
	SetPicture('C_NOTSELECTEDPIC', 4)
	SetPicture('C_SELECTEDPIC', 5)
	SetPicture('C_NOTSELECTEDPIC', 6)
elseif soundMode == "AdLib" then
	SetPicture('C_NOTSELECTEDPIC', 4)
	SetPicture('C_NOTSELECTEDPIC', 5)
	SetPicture('C_SELECTEDPIC', 6)
end

-- Digitized Sound toggles (items 3-4, picture indices 7-8)
if digiMode == "Off" then
	SetPicture('C_SELECTEDPIC', 7)
	SetPicture('C_NOTSELECTEDPIC', 8)
elseif digiMode == "SoundBlaster" then
	SetPicture('C_NOTSELECTEDPIC', 7)
	SetPicture('C_SELECTEDPIC', 8)
end

-- Music toggles (items 5-6, picture indices 9-10)
if not musicEnabled then
	SetPicture('C_SELECTEDPIC', 9)
	SetPicture('C_NOTSELECTEDPIC', 10)
else
	SetPicture('C_NOTSELECTEDPIC', 9)
	SetPicture('C_SELECTEDPIC', 10)
end
					]]>
				</OnSelectionChanged>

				<!-- Menu Items (WL_MENU.C:164-195) -->
				<!-- Sound Effects section (items 0-2) -->
				<MenuItem Text="None">
					SetSoundMode('Off')
					RefreshMenu()
				</MenuItem>
				<MenuItem Text="PC Speaker">
					SetSoundMode('PC')
					RefreshMenu()
				</MenuItem>
				<MenuItem Text="AdLib/Sound Blaster">
					SetSoundMode('AdLib')
					RefreshMenu()
				</MenuItem>

				<!-- Digitized Sound section (items 3-4) -->
				<!-- ExtraSpacing=26 creates gap of 2 items (original items 3-4 were empty spacers) -->
				<MenuItem Text="None" ExtraSpacing="26">
					SetDigiMode('Off')
					RefreshMenu()
				</MenuItem>
				<MenuItem Text="Sound Blaster">
					SetDigiMode('SoundBlaster')
					RefreshMenu()
				</MenuItem>

				<!-- Music section (items 5-6) -->
				<!-- ExtraSpacing=39 creates gap of 3 items (original items 3-4 spacers + Disney item) -->
				<MenuItem Text="None" ExtraSpacing="39">
					SetMusicEnabled(false)
					RefreshMenu()
				</MenuItem>
				<MenuItem Text="AdLib">
					SetMusicEnabled(true)
					RefreshMenu()
				</MenuItem>
			</Menu>

			<Menu Name="Control" X="76" Y="70" Indent="24" Spacing="13" Font="BIG">
				<MenuItem Text="Mouse Enabled" Action="BackToPreviousMenu" />
				<MenuItem Text="Joystick Enabled" Action="BackToPreviousMenu" />
				<MenuItem Text="Back" Action="BackToPreviousMenu" />
			</Menu>

			<Menu Name="LoadGame" X="76" Y="55" Indent="24" Spacing="13" Font="BIG">
				<MenuItem Text="[Empty Slot]" Action="BackToPreviousMenu" />
				<MenuItem Text="Back" Action="BackToPreviousMenu" />
			</Menu>

			<Menu Name="SaveGame" X="76" Y="55" Indent="24" Spacing="13" Font="BIG">
				<MenuItem Text="[Empty Slot]" Action="BackToPreviousMenu" />
				<MenuItem Text="Back" Action="BackToPreviousMenu" />
			</Menu>

			<Menu Name="ChangeView" X="76" Y="55" Indent="24" Spacing="13" Font="BIG">
				<MenuItem Text="Size 1" Action="BackToPreviousMenu" />
				<MenuItem Text="Size 2" Action="BackToPreviousMenu" />
				<MenuItem Text="Back" Action="BackToPreviousMenu" />
			</Menu>

			<Menu Name="ViewScores" X="76" Y="55" Indent="24" Spacing="13" Font="BIG">
				<MenuItem Text="No scores yet" Action="BackToPreviousMenu" />
				<MenuItem Text="Back" Action="BackToPreviousMenu" />
			</Menu>
		</Menus>
	</VgaGraph>
	<Maps MapHead="MAPHEAD.WL1" GameMaps="GAMEMAPS.WL1" Floor="25" Ceiling="29" >
		<Map Number="0" Episode="1" Level="1" Par="00:01:30" Music="GETTHEM_MUS" AltElevatorTo="9" />
		<Map Number="1" Episode="1" Level="2" Par="00:02:00" Music="SEARCHN_MUS" />
		<Map Number="2" Episode="1" Level="3" Par="00:02:00" Music="POW_MUS" />
		<Map Number="3" Episode="1" Level="4" Par="00:03:30" Music="SUSPENSE_MUS" />
		<Map Number="4" Episode="1" Level="5" Par="00:03:00" Music="GETTHEM_MUS" />
		<Map Number="5" Episode="1" Level="6" Par="00:03:00" Music="SEARCHN_MUS" />
		<Map Number="6" Episode="1" Level="7" Par="00:02:30" Music="POW_MUS" />
		<Map Number="7" Episode="1" Level="8" Par="00:02:30" Music="SUSPENSE_MUS" />
		<Map Number="8" Episode="1" Level="9" Music="WARMARCH_MUS" />
		<Map Number="9" Episode="1" Level="10" Ceiling="191" Music="CORNER_MUS" ElevatorTo="1" />
	</Maps>
	<Audio AudioHead="AUDIOHED.WL1" AudioT="AUDIOT.WL1" StartPCSounds="0" StartAdlibSounds="87" StartMusic="261" >
		<Sound Number="0" Name="HITWALLSND" />
		<Sound Number="1" Name="SELECTWPNSND" />
		<Sound Number="2" Name="SELECTITEMSND" />
		<Sound Number="3" Name="HEARTBEATSND" />
		<Sound Number="4" Name="MOVEGUN2SND" />
		<Sound Number="5" Name="MOVEGUN1SND" />
		<Sound Number="6" Name="NOWAYSND" />
		<Sound Number="7" Name="NAZIHITPLAYERSND" />
		<Sound Number="8" Name="FIRESND" />
		<Sound Number="9" Name="PLAYERDEATHSND" />
		<Sound Number="10" Name="DOGDEATHSND" />
		<Sound Number="11" Name="ATKGATLINGSND" />
		<Sound Number="12" Name="GETKEYSND" />
		<Sound Number="13" Name="NOITEMSND" />
		<Sound Number="14" Name="WALK1SND" />
		<Sound Number="15" Name="WALK2SND" />
		<Sound Number="16" Name="TAKEDAMAGESND" />
		<Sound Number="17" Name="GAMEOVERSND" />
		<Sound Number="18" Name="OPENDOORSND" />
		<Sound Number="19" Name="CLOSEDOORSND" />
		<Sound Number="20" Name="DONOTHINGSND" />
		<Sound Number="21" Name="HALTSND" />
		<Sound Number="22" Name="DEATHSCREAM2SND" />
		<Sound Number="23" Name="ATKKNIFESND" />
		<Sound Number="24" Name="ATKPISTOLSND" />
		<Sound Number="25" Name="DEATHSCREAM3SND" />
		<Sound Number="26" Name="ATKMACHINEGUNSND" />
		<Sound Number="27" Name="HITENEMYSND" />
		<Sound Number="28" Name="SHOOTDOORSND" />
		<Sound Number="29" Name="DEATHSCREAM1SND" />
		<Sound Number="30" Name="GETMACHINESND" />
		<Sound Number="31" Name="GETAMMOSND" />
		<Sound Number="32" Name="SHOOTSND" />
		<Sound Number="33" Name="HEALTH1SND" />
		<Sound Number="34" Name="HEALTH2SND" />
		<Sound Number="35" Name="BONUS1SND" />
		<Sound Number="36" Name="BONUS2SND" />
		<Sound Number="37" Name="BONUS3SND" />
		<Sound Number="38" Name="GETGATLINGSND" />
		<Sound Number="39" Name="ESCPRESSEDSND" />
		<Sound Number="40" Name="LEVELDONESND" />
		<Sound Number="41" Name="DOGBARKSND" />
		<Sound Number="42" Name="ENDBONUS1SND" />
		<Sound Number="43" Name="ENDBONUS2SND" />
		<Sound Number="44" Name="BONUS1UPSND" />
		<Sound Number="45" Name="BONUS4SND" />
		<Sound Number="46" Name="PUSHWALLSND" />
		<Sound Number="47" Name="NOBONUSSND" />
		<Sound Number="48" Name="PERCENT100SND" />
		<Sound Number="49" Name="BOSSACTIVESND" />
		<Sound Number="50" Name="MUTTISND" />
		<Sound Number="51" Name="SCHUTZADSND" />
		<Sound Number="52" Name="AHHHGSND" />
		<Sound Number="53" Name="DIESND" />
		<Sound Number="54" Name="EVASND" />
		<Sound Number="55" Name="GUTENTAGSND" />
		<Sound Number="56" Name="LEBENSND" />
		<Sound Number="57" Name="SCHEISTSND" />
		<Sound Number="58" Name="NAZIFIRESND" />
		<Sound Number="59" Name="BOSSFIRESND" />
		<Sound Number="60" Name="SSFIRESND" />
		<Sound Number="61" Name="SLURPIESND" />
		<Sound Number="62" Name="TOT_HUNDSND" />
		<Sound Number="63" Name="MEINGOTTSND" />
		<Sound Number="64" Name="SCHABBSHASND" />
		<Sound Number="65" Name="HITLERHASND" />
		<Sound Number="66" Name="SPIONSND" />
		<Sound Number="67" Name="NEINSOVASSND" />
		<Sound Number="68" Name="DOGATTACKSND" />
		<Sound Number="69" Name="FLAMETHROWERSND" />
		<Sound Number="70" Name="MECHSTEPSND" />
		<Sound Number="71" Name="GOOBSSND" />
		<Sound Number="72" Name="YEAHSND" />
		<Sound Number="73" Name="DEATHSCREAM4SND" />
		<Sound Number="74" Name="DEATHSCREAM5SND" />
		<Sound Number="75" Name="DEATHSCREAM6SND" />
		<Sound Number="76" Name="DEATHSCREAM7SND" />
		<Sound Number="77" Name="DEATHSCREAM8SND" />
		<Sound Number="78" Name="DEATHSCREAM9SND" />
		<Sound Number="79" Name="DONNERSND" />
		<Sound Number="80" Name="EINESND" />
		<Sound Number="81" Name="ERLAUBENSND" />
		<Sound Number="82" Name="KEINSND" />
		<Sound Number="83" Name="MEINSND" />
		<Sound Number="84" Name="ROSESND" />
		<Sound Number="85" Name="MISSILEFIRESND" />
		<Sound Number="86" Name="MISSILEHITSND" />
		<Imf Number="0" Name="CORNER_MUS" />
		<Imf Number="1" Name="DUNGEON_MUS" />
		<Imf Number="2" Name="WARMARCH_MUS" />
		<Imf Number="3" Name="GETTHEM_MUS" />
		<Imf Number="4" Name="HEADACHE_MUS" />
		<Imf Number="5" Name="HITLWLTZ_MUS" />
		<Imf Number="6" Name="INTROCW3_MUS" />
		<Imf Number="7" Name="NAZI_NOR_MUS" />
		<Imf Number="8" Name="NAZI_OMI_MUS" />
		<Imf Number="9" Name="POW_MUS" />
		<Imf Number="10" Name="SALUTE_MUS" />
		<Imf Number="11" Name="SEARCHN_MUS" />
		<Imf Number="12" Name="SUSPENSE_MUS" />
		<Imf Number="13" Name="VICTORS_MUS" />
		<Imf Number="14" Name="WONDERIN_MUS" />
		<Imf Number="15" Name="FUNKYOU_MUS" />
		<Imf Number="16" Name="ENDLEVEL_MUS" />
		<Imf Number="17" Name="GOINGAFT_MUS" />
		<Imf Number="18" Name="PREGNANT_MUS" />
		<Imf Number="19" Name="ULTIMATE_MUS" />
		<Imf Number="20" Name="NAZI_RAP_MUS" />
		<Imf Number="21" Name="ZEROHOUR_MUS" />
		<Imf Number="22" Name="TWELFTH_MUS" />
		<Imf Number="23" Name="ROSTER_MUS" />
		<Imf Number="24" Name="URAHERO_MUS" />
		<Imf Number="25" Name="VICMARCH_MUS" />
		<Imf Number="26" Name="PACMAN_MUS" />
	</Audio>
	<VSwap Name="VSWAP.WL1" Sqrt="64" Scale="8" MipMaps="true">

		<!-- GameplayWeapons Section (for simulation) -->
		<!-- All weapon behavior defined here via Lua scripts - no hardcoding in C# -->
		<!-- Based on WL_AGENT.C attackinfo structure (line 75) -->
		<GameplayWeapons>
			<!-- Knife (wp_knife = 0) - WL_AGENT.C:attackinfo[0] -->
			<GameplayWeapon
				Name="knife"
				WeaponNumber="0"
				IdleState="s_knife"
				FireState="s_knife_1"
				RequiresAmmo="false"
				AmmoType="none"
				AmmoPerShot="0"
				FireSound="ATKKNIFESND"/>
			<!-- Pistol (wp_pistol = 1) - WL_AGENT.C:attackinfo[1] -->
			<GameplayWeapon
				Name="pistol"
				WeaponNumber="1"
				IdleState="s_pistol"
				FireState="s_pistol_1"
				RequiresAmmo="true"
				AmmoType="bullets"
				AmmoPerShot="1"
				FireSound="ATKPISTOLSND"
				BaseDamage="5"
				MaxRange="100"/>
			<!-- Machine Gun (wp_machinegun = 2) - WL_AGENT.C:attackinfo[2] -->
			<GameplayWeapon
				Name="machinegun"
				WeaponNumber="2"
				IdleState="s_machinegun"
				FireState="s_machinegun_1"
				RequiresAmmo="true"
				AmmoType="bullets"
				AmmoPerShot="1"
				FireSound="ATKMACHINEGUNSND"
				BaseDamage="5"
				MaxRange="100"
				RapidFire="true"/>
			<!-- Chain Gun (wp_chaingun = 3) - WL_AGENT.C:attackinfo[3] -->
			<GameplayWeapon
				Name="chaingun"
				WeaponNumber="3"
				IdleState="s_chaingun"
				FireState="s_chaingun_1"
				RequiresAmmo="true"
				AmmoType="bullets"
				AmmoPerShot="1"
				FireSound="ATKGATLINGSND"
				BaseDamage="5"
				MaxRange="100"
				RapidFire="true"/>
		</GameplayWeapons>
		<WallPlane MaxWallTiles="64" DoorWall="98" FloorCodeFirst="107" FloorCodeLast="143">
			<!-- Walls 1-63 follow formula: horizwall[i]=(i-1)*2, vertwall[i]=(i-1)*2+1 -->

			<!-- Special floor tiles -->
			<Elevator Tile="21" PressedTile="22" Faces="EastWest" Sound="LEVELDONESND" />
			<Pushable Tile="98" />
			<Exit Tile="99" />
			<Ambush Tile="106" />
			<AltElevator Tile="107" />

			<!-- Door types: Tile is base (even), Tile+1 (odd) implied -->
			<!-- Doors with no script open freely. Doors with scripts return true to open, false to stay locked. -->
			<Door Tile="90" Name="normal" Page="0" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" />
			<Door Tile="92" Name="gold" Key="Gold Key" Page="6" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" LockedSound="NOWAYSND"><![CDATA[
if Has("Gold Key") then
	return true
end
PlayLocalDigiSound("NOWAYSND")
return false
]]></Door>
			<Door Tile="94" Name="silver" Key="Silver Key" Page="6" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" LockedSound="NOWAYSND"><![CDATA[
if Has("Silver Key") then
	return true
end
PlayLocalDigiSound("NOWAYSND")
return false
]]></Door>
			<Door Tile="96" Name="gold2" Key="Gold Key" Page="6" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" LockedSound="NOWAYSND"><![CDATA[
if Has("Gold Key") then
	return true
end
PlayLocalDigiSound("NOWAYSND")
return false
]]></Door>
			<Door Tile="98" Name="silver2" Key="Silver Key" Page="6" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" LockedSound="NOWAYSND"><![CDATA[
if Has("Silver Key") then
	return true
end
PlayLocalDigiSound("NOWAYSND")
return false
]]></Door>
			<Door Tile="100" Name="elevator" Page="4" OpenSound="OPENDOORSND" CloseSound="CLOSEDOORSND" />
		</WallPlane>
		<SpritePlane>
			<Sprite Page="106" Name="SPR_DEMO" />
			<Sprite Page="107" Name="SPR_DEATHCAM" />
			<Sprite Page="156" Name="SPR_GRD_S_1" />
			<Sprite Page="157" Name="SPR_GRD_S_2" />
			<Sprite Page="158" Name="SPR_GRD_S_3" />
			<Sprite Page="159" Name="SPR_GRD_S_4" />
			<Sprite Page="160" Name="SPR_GRD_S_5" />
			<Sprite Page="161" Name="SPR_GRD_S_6" />
			<Sprite Page="162" Name="SPR_GRD_S_7" />
			<Sprite Page="163" Name="SPR_GRD_S_8" />
			<Sprite Page="164" Name="SPR_GRD_W1_1" />
			<Sprite Page="165" Name="SPR_GRD_W1_2" />
			<Sprite Page="166" Name="SPR_GRD_W1_3" />
			<Sprite Page="167" Name="SPR_GRD_W1_4" />
			<Sprite Page="168" Name="SPR_GRD_W1_5" />
			<Sprite Page="169" Name="SPR_GRD_W1_6" />
			<Sprite Page="170" Name="SPR_GRD_W1_7" />
			<Sprite Page="171" Name="SPR_GRD_W1_8" />
			<Sprite Page="172" Name="SPR_GRD_W2_1" />
			<Sprite Page="173" Name="SPR_GRD_W2_2" />
			<Sprite Page="174" Name="SPR_GRD_W2_3" />
			<Sprite Page="175" Name="SPR_GRD_W2_4" />
			<Sprite Page="176" Name="SPR_GRD_W2_5" />
			<Sprite Page="177" Name="SPR_GRD_W2_6" />
			<Sprite Page="178" Name="SPR_GRD_W2_7" />
			<Sprite Page="179" Name="SPR_GRD_W2_8" />
			<Sprite Page="180" Name="SPR_GRD_W3_1" />
			<Sprite Page="181" Name="SPR_GRD_W3_2" />
			<Sprite Page="182" Name="SPR_GRD_W3_3" />
			<Sprite Page="183" Name="SPR_GRD_W3_4" />
			<Sprite Page="184" Name="SPR_GRD_W3_5" />
			<Sprite Page="185" Name="SPR_GRD_W3_6" />
			<Sprite Page="186" Name="SPR_GRD_W3_7" />
			<Sprite Page="187" Name="SPR_GRD_W3_8" />
			<Sprite Page="188" Name="SPR_GRD_W4_1" />
			<Sprite Page="189" Name="SPR_GRD_W4_2" />
			<Sprite Page="190" Name="SPR_GRD_W4_3" />
			<Sprite Page="191" Name="SPR_GRD_W4_4" />
			<Sprite Page="192" Name="SPR_GRD_W4_5" />
			<Sprite Page="193" Name="SPR_GRD_W4_6" />
			<Sprite Page="194" Name="SPR_GRD_W4_7" />
			<Sprite Page="195" Name="SPR_GRD_W4_8" />
			<Sprite Page="196" Name="SPR_GRD_PAIN_1" />
			<Sprite Page="197" Name="SPR_GRD_DIE_1" />
			<Sprite Page="198" Name="SPR_GRD_DIE_2" />
			<Sprite Page="199" Name="SPR_GRD_DIE_3" />
			<Sprite Page="200" Name="SPR_GRD_PAIN_2" />
			<Sprite Page="201" Name="SPR_GRD_DEAD" />
			<Sprite Page="202" Name="SPR_GRD_SHOOT1" />
			<Sprite Page="203" Name="SPR_GRD_SHOOT2" />
			<Sprite Page="204" Name="SPR_GRD_SHOOT3" />
			<Sprite Page="205" Name="SPR_DOG_W1_1" />
			<Sprite Page="206" Name="SPR_DOG_W1_2" />
			<Sprite Page="207" Name="SPR_DOG_W1_3" />
			<Sprite Page="208" Name="SPR_DOG_W1_4" />
			<Sprite Page="209" Name="SPR_DOG_W1_5" />
			<Sprite Page="210" Name="SPR_DOG_W1_6" />
			<Sprite Page="211" Name="SPR_DOG_W1_7" />
			<Sprite Page="212" Name="SPR_DOG_W1_8" />
			<Sprite Page="213" Name="SPR_DOG_W2_1" />
			<Sprite Page="214" Name="SPR_DOG_W2_2" />
			<Sprite Page="215" Name="SPR_DOG_W2_3" />
			<Sprite Page="216" Name="SPR_DOG_W2_4" />
			<Sprite Page="217" Name="SPR_DOG_W2_5" />
			<Sprite Page="218" Name="SPR_DOG_W2_6" />
			<Sprite Page="219" Name="SPR_DOG_W2_7" />
			<Sprite Page="220" Name="SPR_DOG_W2_8" />
			<Sprite Page="221" Name="SPR_DOG_W3_1" />
			<Sprite Page="222" Name="SPR_DOG_W3_2" />
			<Sprite Page="223" Name="SPR_DOG_W3_3" />
			<Sprite Page="224" Name="SPR_DOG_W3_4" />
			<Sprite Page="225" Name="SPR_DOG_W3_5" />
			<Sprite Page="226" Name="SPR_DOG_W3_6" />
			<Sprite Page="227" Name="SPR_DOG_W3_7" />
			<Sprite Page="228" Name="SPR_DOG_W3_8" />
			<Sprite Page="229" Name="SPR_DOG_W4_1" />
			<Sprite Page="230" Name="SPR_DOG_W4_2" />
			<Sprite Page="231" Name="SPR_DOG_W4_3" />
			<Sprite Page="232" Name="SPR_DOG_W4_4" />
			<Sprite Page="233" Name="SPR_DOG_W4_5" />
			<Sprite Page="234" Name="SPR_DOG_W4_6" />
			<Sprite Page="235" Name="SPR_DOG_W4_7" />
			<Sprite Page="236" Name="SPR_DOG_W4_8" />
			<Sprite Page="237" Name="SPR_DOG_DIE_1" />
			<Sprite Page="238" Name="SPR_DOG_DIE_2" />
			<Sprite Page="239" Name="SPR_DOG_DIE_3" />
			<Sprite Page="240" Name="SPR_DOG_DEAD" />
			<Sprite Page="241" Name="SPR_DOG_JUMP1" />
			<Sprite Page="242" Name="SPR_DOG_JUMP2" />
			<Sprite Page="243" Name="SPR_DOG_JUMP3" />
			<Sprite Page="244" Name="SPR_SS_S_1" />
			<Sprite Page="245" Name="SPR_SS_S_2" />
			<Sprite Page="246" Name="SPR_SS_S_3" />
			<Sprite Page="247" Name="SPR_SS_S_4" />
			<Sprite Page="248" Name="SPR_SS_S_5" />
			<Sprite Page="249" Name="SPR_SS_S_6" />
			<Sprite Page="250" Name="SPR_SS_S_7" />
			<Sprite Page="251" Name="SPR_SS_S_8" />
			<Sprite Page="252" Name="SPR_SS_W1_1" />
			<Sprite Page="253" Name="SPR_SS_W1_2" />
			<Sprite Page="254" Name="SPR_SS_W1_3" />
			<Sprite Page="255" Name="SPR_SS_W1_4" />
			<Sprite Page="256" Name="SPR_SS_W1_5" />
			<Sprite Page="257" Name="SPR_SS_W1_6" />
			<Sprite Page="258" Name="SPR_SS_W1_7" />
			<Sprite Page="259" Name="SPR_SS_W1_8" />
			<Sprite Page="260" Name="SPR_SS_W2_1" />
			<Sprite Page="261" Name="SPR_SS_W2_2" />
			<Sprite Page="262" Name="SPR_SS_W2_3" />
			<Sprite Page="263" Name="SPR_SS_W2_4" />
			<Sprite Page="264" Name="SPR_SS_W2_5" />
			<Sprite Page="265" Name="SPR_SS_W2_6" />
			<Sprite Page="266" Name="SPR_SS_W2_7" />
			<Sprite Page="267" Name="SPR_SS_W2_8" />
			<Sprite Page="268" Name="SPR_SS_W3_1" />
			<Sprite Page="269" Name="SPR_SS_W3_2" />
			<Sprite Page="270" Name="SPR_SS_W3_3" />
			<Sprite Page="271" Name="SPR_SS_W3_4" />
			<Sprite Page="272" Name="SPR_SS_W3_5" />
			<Sprite Page="273" Name="SPR_SS_W3_6" />
			<Sprite Page="274" Name="SPR_SS_W3_7" />
			<Sprite Page="275" Name="SPR_SS_W3_8" />
			<Sprite Page="276" Name="SPR_SS_W4_1" />
			<Sprite Page="277" Name="SPR_SS_W4_2" />
			<Sprite Page="278" Name="SPR_SS_W4_3" />
			<Sprite Page="279" Name="SPR_SS_W4_4" />
			<Sprite Page="280" Name="SPR_SS_W4_5" />
			<Sprite Page="281" Name="SPR_SS_W4_6" />
			<Sprite Page="282" Name="SPR_SS_W4_7" />
			<Sprite Page="283" Name="SPR_SS_W4_8" />
			<Sprite Page="284" Name="SPR_SS_PAIN_1" />
			<Sprite Page="285" Name="SPR_SS_DIE_1" />
			<Sprite Page="286" Name="SPR_SS_DIE_2" />
			<Sprite Page="287" Name="SPR_SS_DIE_3" />
			<Sprite Page="288" Name="SPR_SS_PAIN_2" />
			<Sprite Page="289" Name="SPR_SS_DEAD" />
			<Sprite Page="290" Name="SPR_SS_SHOOT1" />
			<Sprite Page="291" Name="SPR_SS_SHOOT2" />
			<Sprite Page="292" Name="SPR_SS_SHOOT3" />
			<Sprite Page="402" Name="SPR_BOSS_W1" />
			<Sprite Page="403" Name="SPR_BOSS_W2" />
			<Sprite Page="404" Name="SPR_BOSS_W3" />
			<Sprite Page="405" Name="SPR_BOSS_W4" />
			<Sprite Page="406" Name="SPR_BOSS_SHOOT1" />
			<Sprite Page="407" Name="SPR_BOSS_SHOOT2" />
			<Sprite Page="408" Name="SPR_BOSS_SHOOT3" />
			<Sprite Page="409" Name="SPR_BOSS_DEAD" />
			<Sprite Page="410" Name="SPR_BOSS_DIE1" />
			<Sprite Page="411" Name="SPR_BOSS_DIE2" />
			<Sprite Page="412" Name="SPR_BOSS_DIE3" />
			<Sprite Page="514" Name="SPR_BJ_W1" />
			<Sprite Page="515" Name="SPR_BJ_W2" />
			<Sprite Page="516" Name="SPR_BJ_W3" />
			<Sprite Page="517" Name="SPR_BJ_W4" />
			<Sprite Page="518" Name="SPR_BJ_JUMP1" />
			<Sprite Page="519" Name="SPR_BJ_JUMP2" />
			<Sprite Page="520" Name="SPR_BJ_JUMP3" />
			<Sprite Page="521" Name="SPR_BJ_JUMP4" />
			<Sprite Page="522" Name="SPR_KNIFEREADY" />
			<Sprite Page="523" Name="SPR_KNIFEATK1" />
			<Sprite Page="524" Name="SPR_KNIFEATK2" />
			<Sprite Page="525" Name="SPR_KNIFEATK3" />
			<Sprite Page="526" Name="SPR_KNIFEATK4" />
			<Sprite Page="527" Name="SPR_PISTOLREADY" />
			<Sprite Page="528" Name="SPR_PISTOLATK1" />
			<Sprite Page="529" Name="SPR_PISTOLATK2" />
			<Sprite Page="530" Name="SPR_PISTOLATK3" />
			<Sprite Page="531" Name="SPR_PISTOLATK4" />
			<Sprite Page="532" Name="SPR_MACHINEGUNREADY" />
			<Sprite Page="533" Name="SPR_MACHINEGUNATK1" />
			<Sprite Page="534" Name="SPR_MACHINEGUNATK2" />
			<Sprite Page="535" Name="SPR_MACHINEGUNATK3" />
			<Sprite Page="536" Name="SPR_MACHINEGUNATK4" />
			<Sprite Page="537" Name="SPR_CHAINREADY" />
			<Sprite Page="538" Name="SPR_CHAINATK1" />
			<Sprite Page="539" Name="SPR_CHAINATK2" />
			<Sprite Page="540" Name="SPR_CHAINATK3" />
			<Sprite Page="541" Name="SPR_CHAINATK4" />
		</SpritePlane>
		<SoundPlane>
			<DigiSound Number="0" Name="HALTSND" />
			<DigiSound Number="1" Name="DOGBARKSND" />
			<DigiSound Number="2" Name="CLOSEDOORSND" />
			<DigiSound Number="3" Name="OPENDOORSND" />
			<DigiSound Number="4" Name="ATKMACHINEGUNSND" />
			<DigiSound Number="5" Name="ATKPISTOLSND" />
			<DigiSound Number="6" Name="ATKGATLINGSND" />
			<DigiSound Number="7" Name="SCHUTZADSND" />
			<DigiSound Number="8" Name="GUTENTAGSND" />
			<DigiSound Number="9" Name="MUTTISND" />
			<DigiSound Number="10" Name="BOSSFIRESND" />
			<DigiSound Number="11" Name="SSFIRESND" />
			<DigiSound Number="12" Name="DEATHSCREAM1SND" />
			<DigiSound Number="13" Name="DEATHSCREAM2SND" />
			<DigiSound Number="14" Name="TAKEDAMAGESND" />
			<DigiSound Number="14" Name="DEATHSCREAM3SND" />
			<DigiSound Number="15" Name="PUSHWALLSND" />
			<DigiSound Number="20" Name="LEBENSND" />
			<DigiSound Number="21" Name="NAZIFIRESND" />
			<DigiSound Number="22" Name="SLURPIESND" />
			<DigiSound Number="32" Name="YEAHSND" />
		</SoundPlane>
		<StatInfo>
			<!-- Bonus pickup scripts -->
			<BonusScript Name="health_small"><![CDATA[
if GetValue("Health") < GetMax("Health") then
	AddValue("Health", 4)
	PlayAdLibSound("HEALTH1SND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="health_medium"><![CDATA[
if GetValue("Health") < GetMax("Health") then
	AddValue("Health", 10)
	PlayAdLibSound("HEALTH1SND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="health_large"><![CDATA[
if GetValue("Health") < GetMax("Health") then
	AddValue("Health", 25)
	PlayAdLibSound("HEALTH2SND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="health_desperate"><![CDATA[
if GetValue("Health") < 12 then
	AddValue("Health", 1)
	PlayLocalDigiSound("SLURPIESND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="key_gold"><![CDATA[
SetValue("Gold Key", 1)
PlayAdLibSound("GETKEYSND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="key_silver"><![CDATA[
SetValue("Silver Key", 1)
PlayAdLibSound("GETKEYSND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="ammo_clip"><![CDATA[
if GetValue("Ammo") < GetMax("Ammo") then
	AddValue("Ammo", 8)
	PlayAdLibSound("GETAMMOSND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="ammo_clip_small"><![CDATA[
if GetValue("Ammo") < GetMax("Ammo") then
	AddValue("Ammo", 4)
	PlayAdLibSound("GETAMMOSND")
	FlashScreen(0xFFF800)
	return true
end
return false
]]></BonusScript>
			<BonusScript Name="weapon_machinegun"><![CDATA[
SetValue("Weapon2", 1)
AddValue("Ammo", 6)
PlayAdLibSound("GETMACHINESND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="weapon_chaingun"><![CDATA[
SetValue("Weapon3", 1)
AddValue("Ammo", 6)
PlayAdLibSound("GETGATLINGSND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="treasure_cross"><![CDATA[
AddValue("Score", 100)
PlayAdLibSound("BONUS1SND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="treasure_chalice"><![CDATA[
AddValue("Score", 500)
PlayAdLibSound("BONUS2SND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="treasure_chest"><![CDATA[
AddValue("Score", 1000)
PlayAdLibSound("BONUS3SND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="treasure_crown"><![CDATA[
AddValue("Score", 5000)
PlayAdLibSound("BONUS4SND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>
			<BonusScript Name="extra_life"><![CDATA[
AddValue("Lives", 1)
SetValue("Health", GetMax("Health"))
AddValue("Ammo", 25)
PlayAdLibSound("BONUS1UPSND")
FlashScreen(0xFFF800)
return true
]]></BonusScript>

			<ObjectType Number="19" ObClass="playerobj" Direction="E" Name="Player Start East" />
			<ObjectType Number="20" ObClass="playerobj" Direction="N" Name="Player Start North" />
			<ObjectType Number="21" ObClass="playerobj" Direction="W" Name="Player Start West" />
			<ObjectType Number="22" ObClass="playerobj" Direction="S" Name="Player Start South" />
			<ObjectType Number="23" ObClass="dressing" Page="108" Name="Pool of Water" />
			<ObjectType Number="24" ObClass="block" Page="109" Name="Oil Drum" />
			<ObjectType Number="25" ObClass="block" Page="110" Name="Table with Chairs" />
			<ObjectType Number="26" ObClass="block" Page="111" Name="Floor Lamp" />
			<ObjectType Number="27" ObClass="dressing" Page="112" Name="Chandalier" />
			<ObjectType Number="28" ObClass="block" Page="113" Name="Hanging Skeleton" />
			<ObjectType Number="29" ObClass="bonus" Page="114" Walk="true" Script="health_small" Name="Dog Food" />
			<ObjectType Number="30" ObClass="block" Page="115" Name="White Column" />
			<ObjectType Number="31" ObClass="block" Page="116" Name="Green Plant" />
			<ObjectType Number="32" ObClass="dressing" Page="117" Name="Skeleton" />
			<ObjectType Number="33" ObClass="block" Page="118" Name="Sink" />
			<ObjectType Number="34" ObClass="block" Page="119" Name="Brown Plant" />
			<ObjectType Number="35" ObClass="block" Page="120" Name="Vase" />
			<ObjectType Number="36" ObClass="block" Page="121" Name="Table" />
			<ObjectType Number="37" ObClass="dressing" Page="122" Name="Ceiling Light" />
			<ObjectType Number="38" ObClass="dressing" Page="123" Name="Utensils (Brown)" />
			<ObjectType Number="39" ObClass="block" Page="124" Name="Armor" />
			<ObjectType Number="40" ObClass="block" Page="125" Name="Empty Cage" />
			<ObjectType Number="41" ObClass="block" Page="126" Name="Cage with Skeleton" />
			<ObjectType Number="42" ObClass="dressing" Page="127" Name="Bones 1" />
			<ObjectType Number="43" ObClass="bonus" Page="128" Script="key_gold" Name="Gold Key" />
			<ObjectType Number="44" ObClass="bonus" Page="129" Script="key_silver" Name="Silver Key" />
			<ObjectType Number="45" ObClass="block" Page="130" Name="Bed" />
			<ObjectType Number="46" ObClass="dressing" Page="131" Name="Basket" />
			<ObjectType Number="47" ObClass="bonus" Page="132" Script="health_medium" Name="Food" />
			<ObjectType Number="48" ObClass="bonus" Page="133" Script="health_large" Name="First Aid Kit" />
			<ObjectType Number="49" ObClass="bonus" Page="134" Script="ammo_clip" Name="Ammo" />
			<ObjectType Number="50" ObClass="bonus" Page="135" Script="weapon_machinegun" Name="Machine Gun" />
			<ObjectType Number="51" ObClass="bonus" Page="136" Script="weapon_chaingun" Name="Gatling Gun" />
			<ObjectType Number="52" ObClass="bonus" Page="137" Treasure="true" Script="treasure_cross" Name="Cross" />
			<ObjectType Number="53" ObClass="bonus" Page="138" Treasure="true" Script="treasure_chalice" Name="Chalice" />
			<ObjectType Number="54" ObClass="bonus" Page="139" Treasure="true" Script="treasure_chest" Name="Chest of Jewels" />
			<ObjectType Number="55" ObClass="bonus" Page="140" Treasure="true" Script="treasure_crown" Name="Crown" />
			<ObjectType Number="56" ObClass="bonus" Page="141" Treasure="true" Script="extra_life" Name="Extra Life" />
			<ObjectType Number="57" ObClass="bonus" Page="142" Script="health_desperate" Name="Bones with Blood" />
			<ObjectType Number="58" ObClass="block" Page="143" Name="Barrel" />
			<ObjectType Number="59" ObClass="block" Page="144" Name="Well with Water" />
			<ObjectType Number="60" ObClass="block" Page="145" Name="Well" />
			<ObjectType Number="61" ObClass="bonus" Page="146" Script="health_desperate" Name="Pool of Blood" />
			<ObjectType Number="62" ObClass="block" Page="147" Name="Flag" />
			<ObjectType Number="63" ObClass="block" Page="148" Name="Aardwolf" />
			<ObjectType Number="64" ObClass="dressing" Page="149" Name="Bones 2" />
			<ObjectType Number="65" ObClass="dressing" Page="150" Name="Bones 3" />
			<ObjectType Number="66" ObClass="dressing" Page="151" Name="Bones 4" />
			<ObjectType Number="67" ObClass="dressing" Page="152" Name="Utensils (Blue)" />
			<ObjectType Number="68" ObClass="block" Page="153" Name="Stove" />
			<ObjectType Number="69" ObClass="block" Page="154" Name="Rack" />
			<ObjectType Number="70" ObClass="block" Page="155" Name="Vines" />
			<!-- Drop-only items: never placed on maps, only spawned by PlaceItemType (enemy death drops) -->
			<!-- WL_ACT1.C:statinfo[] last entry: {SPR_STAT_26,bo_clip2} - same sprite as bo_clip but gives 4 ammo instead of 8 -->
			<ObjectType Number="71" ObClass="bonus" Page="134" Script="ammo_clip_small" Name="bo_clip2" />
			<Turn Number="90" Direction="E" Name="Turn E" />
			<Turn Number="91" Direction="NE" Name="Turn NE" />
			<Turn Number="92" Direction="N" Name="Turn N" />
			<Turn Number="93" Direction="NW" Name="Turn NW" />
			<Turn Number="94" Direction="W" Name="Turn W" />
			<Turn Number="95" Direction="SW" Name="Turn SW" />
			<Turn Number="96" Direction="S" Name="Turn S" />
			<Turn Number="97" Direction="SE" Name="Turn SE" />
			<Pushwall Number="98" DigiSound="PUSHWALLSND" Name="Secret Door" />
			<Trigger Number="99" Name="End Game Trigger" />
			<ObjectType Number="108" ObClass="actor" Actor="Guard" Direction="E" Difficulty="1" State="s_grdstand" />
			<ObjectType Number="109" ObClass="actor" Actor="Guard" Direction="N" Difficulty="1" State="s_grdstand" />
			<ObjectType Number="110" ObClass="actor" Actor="Guard" Direction="W" Difficulty="1" State="s_grdstand" />
			<ObjectType Number="111" ObClass="actor" Actor="Guard" Direction="S" Difficulty="1" State="s_grdstand" />
			<ObjectType Number="112" ObClass="actor" Actor="Guard" Direction="E" Difficulty="1" State="s_grdpath1" />
			<ObjectType Number="113" ObClass="actor" Actor="Guard" Direction="N" Difficulty="1" State="s_grdpath1" />
			<ObjectType Number="114" ObClass="actor" Actor="Guard" Direction="W" Difficulty="1" State="s_grdpath1" />
			<ObjectType Number="115" ObClass="actor" Actor="Guard" Direction="S" Difficulty="1" State="s_grdpath1" />
			<ObjectType Number="124" ObClass="dressing" Page="201" Name="Dead Guard" />
			<ObjectType Number="126" ObClass="actor" Actor="SS" Direction="E" Difficulty="1" State="s_ssstand" />
			<ObjectType Number="127" ObClass="actor" Actor="SS" Direction="N" Difficulty="1" State="s_ssstand" />
			<ObjectType Number="128" ObClass="actor" Actor="SS" Direction="W" Difficulty="1" State="s_ssstand" />
			<ObjectType Number="129" ObClass="actor" Actor="SS" Direction="S" Difficulty="1" State="s_ssstand" />
			<ObjectType Number="130" ObClass="actor" Actor="SS" Direction="E" Difficulty="1" State="s_sspath1" />
			<ObjectType Number="131" ObClass="actor" Actor="SS" Direction="N" Difficulty="1" State="s_sspath1" />
			<ObjectType Number="132" ObClass="actor" Actor="SS" Direction="W" Difficulty="1" State="s_sspath1" />
			<ObjectType Number="133" ObClass="actor" Actor="SS" Direction="S" Difficulty="1" State="s_sspath1" />
			<ObjectType Number="138" ObClass="actor" Actor="Dog" Direction="E" Difficulty="1" State="s_dogpath1" />
			<ObjectType Number="139" ObClass="actor" Actor="Dog" Direction="N" Difficulty="1" State="s_dogpath1" />
			<ObjectType Number="140" ObClass="actor" Actor="Dog" Direction="W" Difficulty="1" State="s_dogpath1" />
			<ObjectType Number="141" ObClass="actor" Actor="Dog" Direction="S" Difficulty="1" State="s_dogpath1" />
			<ObjectType Number="144" ObClass="actor" Actor="Guard" Direction="E" Difficulty="3" State="s_grdstand" />
			<ObjectType Number="145" ObClass="actor" Actor="Guard" Direction="N" Difficulty="3" State="s_grdstand" />
			<ObjectType Number="146" ObClass="actor" Actor="Guard" Direction="W" Difficulty="3" State="s_grdstand" />
			<ObjectType Number="147" ObClass="actor" Actor="Guard" Direction="S" Difficulty="3" State="s_grdstand" />
			<ObjectType Number="148" ObClass="actor" Actor="Guard" Direction="E" Difficulty="3" State="s_grdpath1" />
			<ObjectType Number="149" ObClass="actor" Actor="Guard" Direction="N" Difficulty="3" State="s_grdpath1" />
			<ObjectType Number="150" ObClass="actor" Actor="Guard" Direction="W" Difficulty="3" State="s_grdpath1" />
			<ObjectType Number="151" ObClass="actor" Actor="Guard" Direction="S" Difficulty="3" State="s_grdpath1" />
			<ObjectType Number="162" ObClass="actor" Actor="SS" Direction="E" Difficulty="3" State="s_ssstand" />
			<ObjectType Number="163" ObClass="actor" Actor="SS" Direction="N" Difficulty="3" State="s_ssstand" />
			<ObjectType Number="164" ObClass="actor" Actor="SS" Direction="W" Difficulty="3" State="s_ssstand" />
			<ObjectType Number="165" ObClass="actor" Actor="SS" Direction="S" Difficulty="3" State="s_ssstand" />
			<ObjectType Number="166" ObClass="actor" Actor="SS" Direction="E" Difficulty="3" State="s_sspath1" />
			<ObjectType Number="167" ObClass="actor" Actor="SS" Direction="N" Difficulty="3" State="s_sspath1" />
			<ObjectType Number="168" ObClass="actor" Actor="SS" Direction="W" Difficulty="3" State="s_sspath1" />
			<ObjectType Number="169" ObClass="actor" Actor="SS" Direction="S" Difficulty="3" State="s_sspath1" />
			<ObjectType Number="174" ObClass="actor" Actor="Dog" Direction="E" Difficulty="3" State="s_dogpath1" />
			<ObjectType Number="175" ObClass="actor" Actor="Dog" Direction="N" Difficulty="3" State="s_dogpath1" />
			<ObjectType Number="176" ObClass="actor" Actor="Dog" Direction="W" Difficulty="3" State="s_dogpath1" />
			<ObjectType Number="177" ObClass="actor" Actor="Dog" Direction="S" Difficulty="3" State="s_dogpath1" />
			<ObjectType Number="180" ObClass="actor" Actor="Guard" Direction="E" Difficulty="4" State="s_grdstand" />
			<ObjectType Number="181" ObClass="actor" Actor="Guard" Direction="N" Difficulty="4" State="s_grdstand" />
			<ObjectType Number="182" ObClass="actor" Actor="Guard" Direction="W" Difficulty="4" State="s_grdstand" />
			<ObjectType Number="183" ObClass="actor" Actor="Guard" Direction="S" Difficulty="4" State="s_grdstand" />
			<ObjectType Number="198" ObClass="actor" Actor="SS" Direction="E" Difficulty="4" State="s_ssstand" />
			<ObjectType Number="199" ObClass="actor" Actor="SS" Direction="N" Difficulty="4" State="s_ssstand" />
			<ObjectType Number="200" ObClass="actor" Actor="SS" Direction="W" Difficulty="4" State="s_ssstand" />
			<ObjectType Number="201" ObClass="actor" Actor="SS" Direction="S" Difficulty="4" State="s_ssstand" />
			<ObjectType Number="202" ObClass="actor" Actor="SS" Direction="E" Difficulty="4" State="s_sspath1" />
			<ObjectType Number="203" ObClass="actor" Actor="SS" Direction="N" Difficulty="4" State="s_sspath1" />
			<ObjectType Number="204" ObClass="actor" Actor="SS" Direction="W" Difficulty="4" State="s_sspath1" />
			<ObjectType Number="205" ObClass="actor" Actor="SS" Direction="S" Difficulty="4" State="s_sspath1" />
			<ObjectType Number="210" ObClass="actor" Actor="Dog" Direction="E" Difficulty="4" State="s_dogpath1" />
			<ObjectType Number="211" ObClass="actor" Actor="Dog" Direction="N" Difficulty="4" State="s_dogpath1" />
			<ObjectType Number="212" ObClass="actor" Actor="Dog" Direction="W" Difficulty="4" State="s_dogpath1" />
			<ObjectType Number="213" ObClass="actor" Actor="Dog" Direction="S" Difficulty="4" State="s_dogpath1" />
			<ObjectType Number="214" ObClass="actor" Actor="Hans" Direction="S" State="s_bossstand" />
			<Actor Name="Guard" HP="25,25,25,25" Reaction="1-64" AlertDigiSound="HALTSND" Stand="s_grdstand" Chase="s_grdchase1" Attack="s_grdshoot1" Death="s_grddie1" Pain="s_grdpain" Pain1="s_grdpain1" />
			<!-- State Functions (Lua implementations of Think/Action) -->
			<Function Name="T_Stand" Description="Actor standing idle, watching for player (generic for all actor types)">
				<![CDATA[
-- WL_ACT2.C:T_Stand - calls SightPlayer
-- WL_STATE.C:SightPlayer (lines 1802-1919) - check for player and transition to chase if spotted

-- WL_STATE.C:1807 - Check if reaction timer is counting down
local reactionTimer = GetReactionTimer()
if reactionTimer > 0 then
	-- WL_STATE.C:1812 - Count down reaction time
	SetReactionTimer(reactionTimer - 1)
	if GetReactionTimer() > 0 then
		return  -- Still counting down, not ready to react
	end
	-- Timer just reached 0, fall through to FirstSighting below
end

-- Timer is 0 (never set or just expired)
-- WL_STATE.C:1817-1832 - Check visibility conditions

-- FL_AMBUSH (0x40) - check if in ambush mode
if HasFlag(0x40) then
	-- Ambush actors only activate with line of sight
	if not CheckSight() then
		return
	end
	ClearFlag(0x40)  -- Clear ambush flag
end

-- Check if player is visible
if not CheckSight() then
	return  -- Can't see player, nothing to do
end

-- Player is visible!
if reactionTimer == 0 and GetReactionTimer() == 0 then
	-- WL_STATE.C:1835-1897 - First time seeing player, set reaction time based on actor type
	local actorType = GetActorType()
	local random = US_RndT()  -- WL_DEF.H:US_RndT() - returns 0-255

	if actorType == "Guard" then
		SetReactionTimer(1 + BitShiftRight(random, 2))  -- 1 + random/4
	elseif actorType == "Dog" then
		SetReactionTimer(1 + BitShiftRight(random, 3))  -- 1 + random/8 (fastest!)
	elseif actorType == "SS" then
		SetReactionTimer(1 + BitShiftRight(random, 2))  -- 1 + random/6 (approx)
	elseif actorType == "Hans" then
		SetReactionTimer(1)  -- Immediate reaction
	else
		-- Default for unknown types
		SetReactionTimer(1)
	end

	-- WL_STATE.C:1913 - return false (don't transition yet, wait for timer)
	return
end

-- Timer has expired (was > 0, now == 0) - WL_STATE.C:1916 - call FirstSighting
-- WL_STATE.C:FirstSighting (lines 1560-1784) - Transition based on actor type
local actorType = GetActorType()

if actorType == "Guard" then
	PlayLocalDigiSound("HALTSND")
	ChangeState("s_grdchase1")
elseif actorType == "Dog" then
	PlayLocalDigiSound("DOGBARKSND")
	ChangeState("s_dogchase1")
elseif actorType == "SS" then
	PlayLocalDigiSound("SCHUTZADSND")
	ChangeState("s_sschase1")
elseif actorType == "Hans" then
	PlayLocalDigiSound("GUTENTAGSND")
	ChangeState("s_bosschase1")
else
	-- Default fallback
	ChangeState("s_grdchase1")
end

-- Set attack mode flags (all actor types)
SetFlag(0x10)  -- FL_ATTACKMODE
SetFlag(0x20)  -- FL_FIRSTATTACK
				]]>
			</Function>
			<State Name="s_grdstand" Rotate="true" Shape="SPR_GRD_S_1" Tics="0" Think="T_Stand" Speed="0" Next="s_grdstand" />
			<State Name="s_grdpath1" Rotate="true" Shape="SPR_GRD_W1_1" Tics="20" Think="T_Path" Speed="512" Next="s_grdpath1s" />
			<State Name="s_grdpath1s" Rotate="true" Shape="SPR_GRD_W1_1" Tics="5" Speed="512" Next="s_grdpath2" />
			<State Name="s_grdpath2" Rotate="true" Shape="SPR_GRD_W2_1" Tics="15" Think="T_Path" Speed="512" Next="s_grdpath3" />
			<State Name="s_grdpath3" Rotate="true" Shape="SPR_GRD_W3_1" Tics="20" Think="T_Path" Speed="512" Next="s_grdpath3s" />
			<State Name="s_grdpath3s" Rotate="true" Shape="SPR_GRD_W3_1" Tics="5" Speed="512" Next="s_grdpath4" />
			<State Name="s_grdpath4" Rotate="true" Shape="SPR_GRD_W4_1" Tics="15" Think="T_Path" Speed="512" Next="s_grdpath1" />
			<State Name="s_grdpain" Shape="SPR_GRD_PAIN_1" Tics="10" Speed="0" Next="s_grdchase1" />
			<State Name="s_grdpain1" Shape="SPR_GRD_PAIN_2" Tics="10" Speed="0" Next="s_grdchase1" />
			<State Name="s_grdshoot1" Shape="SPR_GRD_SHOOT1" Tics="20" Speed="0" Next="s_grdshoot2" />
			<State Name="s_grdshoot2" Shape="SPR_GRD_SHOOT2" Tics="20" Action="T_Shoot" Speed="0" Next="s_grdshoot3" />
			<State Name="s_grdshoot3" Shape="SPR_GRD_SHOOT3" Tics="20" Speed="0" Next="s_grdchase1" />
			<State Name="s_grdchase1" Rotate="true" Shape="SPR_GRD_W1_1" Tics="10" Think="T_Chase" Speed="1536" Next="s_grdchase1s" />
			<State Name="s_grdchase1s" Rotate="true" Shape="SPR_GRD_W1_1" Tics="3" Speed="1536" Next="s_grdchase2" />
			<State Name="s_grdchase2" Rotate="true" Shape="SPR_GRD_W2_1" Tics="8" Think="T_Chase" Speed="1536" Next="s_grdchase3" />
			<State Name="s_grdchase3" Rotate="true" Shape="SPR_GRD_W3_1" Tics="10" Think="T_Chase" Speed="1536" Next="s_grdchase3s" />
			<State Name="s_grdchase3s" Rotate="true" Shape="SPR_GRD_W3_1" Tics="3" Speed="1536" Next="s_grdchase4" />
			<State Name="s_grdchase4" Rotate="true" Shape="SPR_GRD_W4_1" Tics="8" Think="T_Chase" Speed="1536" Next="s_grdchase1" />
			<State Name="s_grddie1" Shape="SPR_GRD_DIE_1" Tics="15" Speed="0" Next="s_grddie2" Action="A_DeathScream" Alive="false" Mark="false" />
			<State Name="s_grddie2" Shape="SPR_GRD_DIE_2" Tics="15" Speed="0" Next="s_grddie3" Alive="false" Mark="false" />
			<State Name="s_grddie3" Shape="SPR_GRD_DIE_3" Tics="15" Speed="0" Next="s_grddie4" Alive="false" Mark="false" />
			<State Name="s_grddie4" Shape="SPR_GRD_DEAD" Tics="0" Speed="0" Next="s_grddie4" Alive="false" Mark="false" />
			<Actor Name="Dog" HP="1,1,1,1" Reaction="1-32" Stand="s_dogpath1" Chase="s_dogchase1" Attack="s_dogjump1" Death="s_dogdie1" />
			<State Name="s_dogpath1" Rotate="true" Shape="SPR_DOG_W1_1" Tics="20" Think="T_Path" Speed="1500" Next="s_dogpath1s" />
			<State Name="s_dogpath1s" Rotate="true" Shape="SPR_DOG_W1_1" Tics="5" Speed="1500" Next="s_dogpath2" />
			<State Name="s_dogpath2" Rotate="true" Shape="SPR_DOG_W2_1" Tics="15" Think="T_Path" Speed="1500" Next="s_dogpath3" />
			<State Name="s_dogpath3" Rotate="true" Shape="SPR_DOG_W3_1" Tics="20" Think="T_Path" Speed="1500" Next="s_dogpath3s" />
			<State Name="s_dogpath3s" Rotate="true" Shape="SPR_DOG_W3_1" Tics="5" Speed="1500" Next="s_dogpath4" />
			<State Name="s_dogpath4" Rotate="true" Shape="SPR_DOG_W4_1" Tics="15" Think="T_Path" Speed="1500" Next="s_dogpath1" />
			<State Name="s_dogjump1" Shape="SPR_DOG_JUMP1" Tics="10" Speed="0" Next="s_dogjump2" />
			<State Name="s_dogjump2" Shape="SPR_DOG_JUMP2" Tics="10" Action="T_Bite" Speed="0" Next="s_dogjump3" />
			<State Name="s_dogjump3" Shape="SPR_DOG_JUMP3" Tics="10" Speed="0" Next="s_dogjump4" />
			<State Name="s_dogjump4" Shape="SPR_DOG_JUMP1" Tics="10" Speed="0" Next="s_dogjump5" />
			<State Name="s_dogjump5" Shape="SPR_DOG_W1_1" Tics="10" Speed="0" Next="s_dogchase1" />
			<State Name="s_dogchase1" Rotate="true" Shape="SPR_DOG_W1_1" Tics="10" Think="T_DogChase" Speed="3000" Next="s_dogchase1s" />
			<State Name="s_dogchase1s" Rotate="true" Shape="SPR_DOG_W1_1" Tics="3" Speed="3000" Next="s_dogchase2" />
			<State Name="s_dogchase2" Rotate="true" Shape="SPR_DOG_W2_1" Tics="8" Think="T_DogChase" Speed="3000" Next="s_dogchase3" />
			<State Name="s_dogchase3" Rotate="true" Shape="SPR_DOG_W3_1" Tics="10" Think="T_DogChase" Speed="3000" Next="s_dogchase3s" />
			<State Name="s_dogchase3s" Rotate="true" Shape="SPR_DOG_W3_1" Tics="3" Speed="3000" Next="s_dogchase4" />
			<State Name="s_dogchase4" Rotate="true" Shape="SPR_DOG_W4_1" Tics="8" Think="T_DogChase" Speed="3000" Next="s_dogchase1" />
			<State Name="s_dogdie1" Shape="SPR_DOG_DIE_1" Tics="15" Speed="0" Next="s_dogdie2" Action="A_DeathScream" Alive="false" Mark="false" />
			<State Name="s_dogdie2" Shape="SPR_DOG_DIE_2" Tics="15" Speed="0" Next="s_dogdie3" Alive="false" Mark="false" />
			<State Name="s_dogdie3" Shape="SPR_DOG_DIE_3" Tics="15" Speed="0" Next="s_dogdead" Alive="false" Mark="false" />
			<State Name="s_dogdead" Shape="SPR_DOG_DEAD" Tics="15" Speed="0" Next="s_dogdead" Alive="false" Mark="false" />
			<Actor Name="SS" HP="100,100,100,100" Reaction="1-43" AlertDigiSound="SCHUTZADSND" Stand="s_ssstand" Chase="s_sschase1" Attack="s_ssshoot1" Death="s_ssdie1" Pain="s_sspain" Pain1="s_sspain1" />
			<State Name="s_ssstand" Rotate="true" Shape="SPR_SS_S_1" Tics="0" Think="T_Stand" Speed="0" Next="s_ssstand" />
			<State Name="s_sspath1" Rotate="true" Shape="SPR_SS_W1_1" Tics="20" Think="T_Path" Speed="512" Next="s_sspath1s" />
			<State Name="s_sspath1s" Rotate="true" Shape="SPR_SS_W1_1" Tics="5" Speed="512" Next="s_sspath2" />
			<State Name="s_sspath2" Rotate="true" Shape="SPR_SS_W2_1" Tics="15" Think="T_Path" Speed="512" Next="s_sspath3" />
			<State Name="s_sspath3" Rotate="true" Shape="SPR_SS_W3_1" Tics="20" Think="T_Path" Speed="512" Next="s_sspath3s" />
			<State Name="s_sspath3s" Rotate="true" Shape="SPR_SS_W3_1" Tics="5" Speed="512" Next="s_sspath4" />
			<State Name="s_sspath4" Rotate="true" Shape="SPR_SS_W4_1" Tics="15" Think="T_Path" Speed="512" Next="s_sspath1" />
			<State Name="s_sspain" Shape="SPR_SS_PAIN_1" Tics="10" Speed="0" Next="s_sschase1" />
			<State Name="s_sspain1" Shape="SPR_SS_PAIN_2" Tics="10" Speed="0" Next="s_sschase1" />
			<State Name="s_ssshoot1" Shape="SPR_SS_SHOOT1" Tics="20" Speed="0" Next="s_ssshoot2" />
			<State Name="s_ssshoot2" Shape="SPR_SS_SHOOT2" Tics="20" Action="T_Shoot" Speed="0" Next="s_ssshoot3" />
			<State Name="s_ssshoot3" Shape="SPR_SS_SHOOT3" Tics="10" Speed="0" Next="s_ssshoot4" />
			<State Name="s_ssshoot4" Shape="SPR_SS_SHOOT2" Tics="10" Action="T_Shoot" Speed="0" Next="s_ssshoot5" />
			<State Name="s_ssshoot5" Shape="SPR_SS_SHOOT3" Tics="10" Speed="0" Next="s_ssshoot6" />
			<State Name="s_ssshoot6" Shape="SPR_SS_SHOOT2" Tics="10" Action="T_Shoot" Speed="0" Next="s_ssshoot7" />
			<State Name="s_ssshoot7" Shape="SPR_SS_SHOOT3" Tics="10" Speed="0" Next="s_ssshoot8" />
			<State Name="s_ssshoot8" Shape="SPR_SS_SHOOT2" Tics="10" Action="T_Shoot" Speed="0" Next="s_ssshoot9" />
			<State Name="s_ssshoot9" Shape="SPR_SS_SHOOT3" Tics="10" Speed="0" Next="s_sschase1" />
			<State Name="s_sschase1" Rotate="true" Shape="SPR_SS_W1_1" Tics="10" Think="T_Chase" Speed="2048" Next="s_sschase1s" />
			<State Name="s_sschase1s" Rotate="true" Shape="SPR_SS_W1_1" Tics="3" Speed="2048" Next="s_sschase2" />
			<State Name="s_sschase2" Rotate="true" Shape="SPR_SS_W2_1" Tics="8" Think="T_Chase" Speed="2048" Next="s_sschase3" />
			<State Name="s_sschase3" Rotate="true" Shape="SPR_SS_W3_1" Tics="10" Think="T_Chase" Speed="2048" Next="s_sschase3s" />
			<State Name="s_sschase3s" Rotate="true" Shape="SPR_SS_W3_1" Tics="3" Speed="2048" Next="s_sschase4" />
			<State Name="s_sschase4" Rotate="true" Shape="SPR_SS_W4_1" Tics="8" Think="T_Chase" Speed="2048" Next="s_sschase1" />
			<State Name="s_ssdie1" Shape="SPR_SS_DIE_1" Tics="15" Speed="0" Next="s_ssdie2" Action="A_DeathScream" Alive="false" Mark="false" />
			<State Name="s_ssdie2" Shape="SPR_SS_DIE_2" Tics="15" Speed="0" Next="s_ssdie3" Alive="false" Mark="false" />
			<State Name="s_ssdie3" Shape="SPR_SS_DIE_3" Tics="15" Speed="0" Next="s_ssdie4" Alive="false" Mark="false" />
			<State Name="s_ssdie4" Shape="SPR_SS_DEAD" Tics="0" Speed="0" Next="s_ssdie4" Alive="false" Mark="false" />
			<Actor Name="Hans" HP="850,950,1050,1200" Reaction="1" AlertDigiSound="GUTENTAGSND" Stand="s_bossstand" Chase="s_bosschase1" Attack="s_bossshoot1" Death="s_bossdie1" Ambush="true" />
			<State Name="s_bossstand" Shape="SPR_BOSS_W1" Tics="0" Think="T_Stand" Speed="0" Next="s_bossstand" />
			<State Name="s_bosschase1" Shape="SPR_BOSS_W1" Tics="10" Think="T_Chase" Speed="512" Next="s_bosschase1s" />
			<State Name="s_bosschase1s" Shape="SPR_BOSS_W1" Tics="3" Speed="512" Next="s_bosschase2" />
			<State Name="s_bosschase2" Shape="SPR_BOSS_W2" Tics="8" Think="T_Chase" Speed="512" Next="s_bosschase3" />
			<State Name="s_bosschase3" Shape="SPR_BOSS_W3" Tics="10" Think="T_Chase" Speed="512" Next="s_bosschase3s" />
			<State Name="s_bosschase3s" Shape="SPR_BOSS_W3" Tics="3" Speed="512" Next="s_bosschase4" />
			<State Name="s_bosschase4" Shape="SPR_BOSS_W4" Tics="8" Think="T_Chase" Speed="512" Next="s_bosschase1" />
			<State Name="s_bossdie1" Shape="SPR_BOSS_DIE1" Tics="15" Speed="0" Next="s_bossdie2" Action="A_DeathScream" Alive="false" />
			<State Name="s_bossdie2" Shape="SPR_BOSS_DIE2" Tics="15" Speed="0" Next="s_bossdie3" Alive="false" Mark="false" />
			<State Name="s_bossdie3" Shape="SPR_BOSS_DIE3" Tics="15" Speed="0" Next="s_bossdie4" Alive="false" Mark="false" />
			<State Name="s_bossdie4" Shape="SPR_BOSS_DEAD" Tics="0" Speed="0" Next="s_bossdie4" Alive="false" Mark="false" />
			<State Name="s_bossshoot1" Shape="SPR_BOSS_SHOOT1" Tics="30" Speed="0" Next="s_bossshoot2" />
			<State Name="s_bossshoot2" Shape="SPR_BOSS_SHOOT2" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot3" />
			<State Name="s_bossshoot3" Shape="SPR_BOSS_SHOOT3" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot4" />
			<State Name="s_bossshoot4" Shape="SPR_BOSS_SHOOT2" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot5" />
			<State Name="s_bossshoot5" Shape="SPR_BOSS_SHOOT3" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot6" />
			<State Name="s_bossshoot6" Shape="SPR_BOSS_SHOOT2" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot7" />
			<State Name="s_bossshoot7" Shape="SPR_BOSS_SHOOT3" Tics="10" Speed="0" Action="T_Shoot" Next="s_bossshoot8" />
			<State Name="s_bossshoot8" Shape="SPR_BOSS_SHOOT1" Tics="10" Speed="0" Next="s_bosschase1" />
			<!-- Weapon States -->
			<!-- Weapon states based on WL_AGENT.C attackinfo structure -->
			<!-- All weapon logic in Lua - fully moddable, no C# hardcoding -->

			<!-- Knife weapon states (wp_knife = 0) - WL_AGENT.C:attackinfo[0] = {{6,0,1},{6,2,2},{6,0,3},{6,-1,4}} -->
			<State Name="s_knife" Rotate="false" Shape="SPR_KNIFEREADY" Tics="0"/>
			<State Name="s_knife_1" Rotate="false" Shape="SPR_KNIFEATK1" Tics="6" Next="s_knife_2"/>
			<State Name="s_knife_2" Rotate="false" Shape="SPR_KNIFEATK2" Tics="6" Action="A_KnifeAttack" Next="s_knife_3"/>
			<State Name="s_knife_3" Rotate="false" Shape="SPR_KNIFEATK3" Tics="6" Next="s_knife_4"/>
			<State Name="s_knife_4" Rotate="false" Shape="SPR_KNIFEATK4" Tics="6" Next="s_knife"/>
			<!-- Pistol weapon states (wp_pistol = 1) - WL_AGENT.C:attackinfo[1] = {{6,0,1},{6,1,2},{6,0,3},{6,-1,4}} -->
			<State Name="s_pistol" Rotate="false" Shape="SPR_PISTOLREADY" Tics="0"/>
			<State Name="s_pistol_1" Rotate="false" Shape="SPR_PISTOLATK1" Tics="6" Next="s_pistol_2"/>
			<State Name="s_pistol_2" Rotate="false" Shape="SPR_PISTOLATK2" Tics="6" Action="A_PistolAttack" Next="s_pistol_3"/>
			<State Name="s_pistol_3" Rotate="false" Shape="SPR_PISTOLATK3" Tics="6" Next="s_pistol_4"/>
			<State Name="s_pistol_4" Rotate="false" Shape="SPR_PISTOLATK4" Tics="6" Action="A_WeaponReady" Next="s_pistol"/>
			<!-- Machine gun weapon states (wp_machinegun = 2) - WL_AGENT.C:attackinfo[2] = {{6,0,1},{6,1,2},{6,3,3},{6,-1,4}} -->
			<State Name="s_machinegun" Rotate="false" Shape="SPR_MACHINEGUNREADY" Tics="0"/>
			<State Name="s_machinegun_1" Rotate="false" Shape="SPR_MACHINEGUNATK1" Tics="6" Next="s_machinegun_2"/>
			<State Name="s_machinegun_2" Rotate="false" Shape="SPR_MACHINEGUNATK2" Tics="6" Action="A_MachineGunAttack" Next="s_machinegun_3"/>
			<State Name="s_machinegun_3" Rotate="false" Shape="SPR_MACHINEGUNATK3" Tics="6" Action="A_RapidFire" Next="s_machinegun_4"/>
			<State Name="s_machinegun_4" Rotate="false" Shape="SPR_MACHINEGUNATK4" Tics="6" Action="A_WeaponReady" Next="s_machinegun"/>
			<!-- Chain gun weapon states (wp_chaingun = 3) - WL_AGENT.C:attackinfo[3] = {{6,0,1},{6,1,2},{6,4,3},{6,-1,4}} -->
			<State Name="s_chaingun" Rotate="false" Shape="SPR_CHAINREADY" Tics="0"/>
			<State Name="s_chaingun_1" Rotate="false" Shape="SPR_CHAINATK1" Tics="6" Next="s_chaingun_2"/>
			<State Name="s_chaingun_2" Rotate="false" Shape="SPR_CHAINATK2" Tics="6" Action="A_ChainGunAttack" Next="s_chaingun_3"/>
			<State Name="s_chaingun_3" Rotate="false" Shape="SPR_CHAINATK3" Tics="6" Action="A_RapidFire" Next="s_chaingun_4"/>
			<State Name="s_chaingun_4" Rotate="false" Shape="SPR_CHAINATK4" Tics="6" Action="A_WeaponReady" Next="s_chaingun"/>
			<!-- Weapon Action Functions -->
			<!-- All weapon behavior is defined in Lua - fully moddable -->
			<Function Name="A_KnifeAttack" Description="Knife melee attack - WL_AGENT.C:KnifeAttack (line 1862)">
				<![CDATA[
-- Knife attack - melee range attack
PlaySound("ATKKNIFESND")
RequestMelee({
	range = 1.5,
	arc = 60,
	damageBase = 0,
	damageRandom = 16  -- US_RndT() >> 4
})
				]]>
			</Function>
			<Function Name="A_PistolAttack" Description="Pistol hitscan attack - WL_AGENT.C:GunAttack (line 1902)">
				<![CDATA[
-- Pistol attack - single hitscan shot
if not HasAmmo(1) then return end
PlaySound("ATKPISTOLSND")
ConsumeAmmo(1)
RequestHitScan({
	maxRange = 100,
	spread = 0,
	damageBase = 5,
	damageRandom = 10,
	damageRangeModifier = true
})
				]]>
			</Function>
			<Function Name="A_MachineGunAttack" Description="Machine gun hitscan attack - WL_AGENT.C:GunAttack">
				<![CDATA[
-- Machine gun attack - single hitscan shot
if not HasAmmo(1) then return end
PlaySound("ATKMACHINEGUNSND")
ConsumeAmmo(1)
RequestHitScan({
	maxRange = 100,
	spread = 0,
	damageBase = 5,
	damageRandom = 10,
	damageRangeModifier = true
})
				]]>
			</Function>
			<Function Name="A_ChainGunAttack" Description="Chain gun hitscan attack - WL_AGENT.C:GunAttack">
				<![CDATA[
-- Chain gun attack - single hitscan shot (can continue without ammo)
if not HasAmmo(1) then return end
PlaySound("ATKGATLINGSND")
ConsumeAmmo(1)
RequestHitScan({
	maxRange = 100,
	spread = 0,
	damageBase = 5,
	damageRandom = 10,
	damageRangeModifier = true
})
				]]>
			</Function>
			<Function Name="A_RapidFire" Description="Rapid fire check - WL_AGENT.C:T_Attack cases 3 and 4 (lines 2203, 2223)">
				<![CDATA[
-- Rapid fire - loop back to firing frame if button held and have ammo
-- WL_AGENT.C case 3 (machine gun) and case 4 (chain gun)
if HasAmmo(1) and IsButtonHeld("attack") then
	-- Get weapon name from current state
	local stateName = GetCurrentStateName()
	if string.find(stateName, "machinegun") then
		SetNextState("s_machinegun_1")
	elseif string.find(stateName, "chaingun") then
		SetNextState("s_chaingun_1")
	end
end
				]]>
			</Function>
			<Function Name="A_WeaponReady" Description="Return to ready state - check ammo and weapon switching - WL_AGENT.C:T_Attack case -1 (line 2146)">
				<![CDATA[
-- End of attack sequence - check if out of ammo
-- WL_AGENT.C case -1: switch to knife if no ammo
if not HasAmmo(1) then
	SwitchToLowestWeapon()
end
				]]>
			</Function>
			<!-- WL_ACT2.C:T_Path -->
			<Function Name="T_Path">
				<![CDATA[
-- WL_ACT2.C:T_Path (lines 4073-4128)
-- Patrol behavior - actor follows patrol path arrows on map (generic for all actor types)

-- WL_ACT2.C:4078 - if (SightPlayer(ob)) return
-- Implements WL_STATE.C:SightPlayer (lines 1802-1919)

-- Check if reaction timer is counting down
local reactionTimer = GetReactionTimer()
if reactionTimer > 0 then
	-- Count down reaction time
	SetReactionTimer(reactionTimer - 1)
	if GetReactionTimer() > 0 then
		return  -- Still counting down
	end
	-- Timer just reached 0, fall through to FirstSighting below
end

-- Timer is 0 - check visibility
-- FL_AMBUSH (0x40) - check if in ambush mode
if HasFlag(0x40) then
	if not CheckSight() then
		return
	end
	ClearFlag(0x40)
end

-- Check if player is visible
if not CheckSight() then
	-- Continue patrolling (fall through to patrol logic below)
else
	-- Player is visible!
	if reactionTimer == 0 and GetReactionTimer() == 0 then
		-- First time seeing player, set reaction time based on actor type
		local actorType = GetActorType()
		local random = US_RndT()  -- WL_DEF.H:US_RndT() - returns 0-255

		if actorType == "Guard" then
			SetReactionTimer(1 + BitShiftRight(random, 2))  -- 1 + random/4
		elseif actorType == "Dog" then
			SetReactionTimer(1 + BitShiftRight(random, 3))  -- 1 + random/8
		elseif actorType == "SS" then
			SetReactionTimer(1 + BitShiftRight(random, 2))  -- 1 + random/6
		elseif actorType == "Hans" then
			SetReactionTimer(1)  -- Immediate
		else
			SetReactionTimer(1)
		end

		return  -- Don't transition yet, wait for timer
	end

	-- Timer has expired - call FirstSighting
	local actorType = GetActorType()

	if actorType == "Guard" then
		PlayLocalDigiSound("HALTSND")
		ChangeState("s_grdchase1")
	elseif actorType == "Dog" then
		PlayLocalDigiSound("DOGBARKSND")
		ChangeState("s_dogchase1")
	elseif actorType == "SS" then
		PlayLocalDigiSound("SCHUTZADSND")
		ChangeState("s_sschase1")
	elseif actorType == "Hans" then
		PlayLocalDigiSound("GUTENTAGSND")
		ChangeState("s_bosschase1")
	else
		ChangeState("s_grdchase1")
	end

	SetFlag(0x10)  -- FL_ATTACKMODE
	SetFlag(0x20)  -- FL_FIRSTATTACK
	return
end

-- WL_ACT2.C:4081 - if (ob->dir == nodir)
if not HasDirection() then
	SelectPathDir()

	-- WL_ACT2.C:4084 - if (ob->dir == nodir) return
	if not HasDirection() then
		return  -- All movement is blocked
	end
end

-- Calculate movement this tic: move = ob->speed * tics
local move = GetSpeed()

-- Movement loop (original: while(move))
while move > 0 do
	if GetDistance() < 0 then
		-- Waiting for door to open
		-- WL_ACT2.C:4098 - OpenDoor(-ob->distance-1)
		local doorIndex = -GetDistance() - 1
		OpenDoor(doorIndex)
		-- WL_ACT2.C:4099 - if (doorobjlist[doornum].action != dr_open) return
		if not IsDoorOpen(doorIndex) then
			return  -- Door not open yet, wait
		end
		-- WL_ACT2.C:4101 - Door is now open, proceed
		SetDistance(0x10000)  -- TILEGLOBAL
	end

	if move < GetDistance() then
		-- Move partial distance within current tile
		MoveObj(move)
		break
	end

	-- Reached next tile - crossed tile boundary
	-- WL_ACT2.C:4119-4120 - Snap to exact tile center
	-- ob->x = ((long)ob->tilex<<TILESHIFT)+TILEGLOBAL/2;
	-- ob->y = ((long)ob->tiley<<TILESHIFT)+TILEGLOBAL/2;
	local tileX = GetTileX()
	local tileY = GetTileY()
	local centerX = (tileX * 65536) + 32768  -- Tile center in 16.16 fixed-point
	local centerY = (tileY * 65536) + 32768
	SetPosition(centerX, centerY)

	-- WL_ACT2.C:4121 - Subtract the distance we just traveled to reach the center
	move = move - GetDistance()

	-- WL_ACT2.C:4123 - SelectPathDir sets new direction and distance = TILEGLOBAL
	SelectPathDir()

	-- WL_ACT2.C:4125 - if (ob->dir == nodir) return
	if not HasDirection() then
		return  -- All movement is blocked
	end
end
			]]>
			</Function>
			<!-- WL_ACT2.C:T_Chase -->
			<Function Name="T_Chase" Description="Chase behavior - actively pursue and attack the player">
				<![CDATA[
-- WL_ACT2.C:T_Chase - Chase and attack player when in range

local dodge = false

-- Check line of sight to player
if CheckSight() then
	-- Calculate distance
	local dx = GetPlayerTileX() - GetTileX()
	local dy = GetPlayerTileY() - GetTileY()
	if dx < 0 then dx = -dx end
	if dy < 0 then dy = -dy end
	local dist = dx
	if dy > dx then dist = dy end

	-- Calculate attack chance based on distance
	local chance = 0
	if dist == 0 or (dist == 1 and GetDistance() < 0x4000) then
		chance = 300  -- Very close - always attack
	else
		chance = BitShiftLeft(1, 4) / dist  -- tics<<4 / dist (tics hardcoded as 1)
	end

	-- Random chance to attack
	if US_RndT() < chance then
		local actorType = GetActorType()
		if actorType == "Guard" then
			ChangeState("s_grdshoot1")
		elseif actorType == "SS" then
			ChangeState("s_ssshoot1")
		elseif actorType == "Hans" then
			ChangeState("s_bossshoot1")
		end
		return
	end

	dodge = true  -- Saw player, use evasive movement
end

-- Select movement direction
if not HasDirection() then
	if dodge then
		SelectDodgeDir(true)  -- Guards can open doors
	else
		SelectChaseDir(true)  -- Guards can open doors
	end

	if not HasDirection() then
		return  -- Blocked in, can't move
	end
end

-- Movement loop
local move = GetSpeed()

while move > 0 do
	local dist = GetDistance()

	-- If distance is 0, we need to select a new direction
	-- This can happen when transitioning from other states (patrol, shoot, etc.)
	if dist == 0 then
		if dodge then
			SelectDodgeDir(true)  -- Guards can open doors
		else
			SelectChaseDir(true)  -- Guards can open doors
		end

		if not HasDirection() then
			return  -- Blocked
		end

		dist = GetDistance()
		if dist == 0 then
			return  -- Still no distance, blocked
		end
	end

	-- Check if waiting for door
	if dist < 0 then
		local doorIndex = -(dist + 1)
		OpenDoor(doorIndex)
		if not IsDoorOpen(doorIndex) then
			return  -- Still waiting
		end
		SetDistance(0x10000)  -- Door open, continue
		dist = 0x10000
	end

	-- Move partial distance
	if move < dist then
		MoveObj(move)
		break
	end

	-- Reached goal tile, snap to center
	local tileX = GetTileX()
	local tileY = GetTileY()
	local centerX = BitShiftLeft(tileX, 16) + 0x8000
	local centerY = BitShiftLeft(tileY, 16) + 0x8000
	SetPosition(centerX, centerY)

	move = move - dist

	-- Select new direction for next tile
	if dodge then
		SelectDodgeDir(true)  -- Guards can open doors
	else
		SelectChaseDir(true)  -- Guards can open doors
	end

	if not HasDirection() then
		return  -- Blocked
	end
end
]]>
			</Function>
			<!-- WL_ACT2.C:T_DogChase -->
			<Function Name="T_DogChase" Description="Dog chase behavior - fast pursuit with bite attack when close">
				<![CDATA[
-- WL_ACT2.C:T_DogChase - Fast dodge movement, bite when very close

-- Select direction (dogs always dodge, cannot open doors)
if not HasDirection() then
	SelectDodgeDir(false)  -- Dogs cannot open doors
	if not HasDirection() then
		return  -- Blocked
	end
end

-- Movement loop
local move = GetSpeed()

while move > 0 do
	-- Check if close enough to bite (fixed-point distance)
	local dx = GetPlayerX() - GetX()
	if dx < 0 then dx = -dx end
	dx = dx - move

	if dx <= 0x10000 then  -- MINACTORDIST
		local dy = GetPlayerY() - GetY()
		if dy < 0 then dy = -dy end
		dy = dy - move

		if dy <= 0x10000 then  -- MINACTORDIST
			ChangeState("s_dogjump1")  -- Bite attack!
			return
		end
	end

	local dist = GetDistance()

	-- Move partial distance
	if move < dist then
		MoveObj(move)
		break
	end

	-- Reached goal tile, snap to center
	local tileX = GetTileX()
	local tileY = GetTileY()
	local centerX = BitShiftLeft(tileX, 16) + 0x8000
	local centerY = BitShiftLeft(tileY, 16) + 0x8000
	SetPosition(centerX, centerY)

	move = move - dist

	-- Select new dodge direction
	SelectDodgeDir(false)  -- Dogs cannot open doors

	if not HasDirection() then
		return  -- Blocked
	end
end
]]>
			</Function>
			<!-- WL_ACT2.C:T_Bite -->
			<Function Name="T_Bite" Description="Dog bite attack - melee damage when adjacent to player">
				<![CDATA[
-- WL_ACT2.C:T_Bite (lines 4270-4305)
-- Dog bite attack: check distance, roll for hit, apply damage

PlayLocalDigiSound("DOGATTACKSND")

-- WL_ACT2.C:4281-4291 - Check if adjacent to player (within 1 tile)
local dx = GetPlayerX() - GetX()
if dx < 0 then dx = -dx end
dx = dx - 0x10000  -- TILEGLOBAL
if dx > 0x10000 then  -- MINACTORDIST
	return
end

local dy = GetPlayerY() - GetY()
if dy < 0 then dy = -dy end
dy = dy - 0x10000  -- TILEGLOBAL
if dy > 0x10000 then  -- MINACTORDIST
	return
end

-- WL_ACT2.C:4293 - 70% hit chance (180/256)
if US_RndT() < 180 then
	-- WL_ACT2.C:4297 - Damage: US_RndT() >> 4 (0-15)
	DamagePlayer(BitShiftRight(US_RndT(), 4))
end
]]>
			</Function>
			<!-- WL_ACT2.C:T_Shoot -->
			<Function Name="T_Shoot" Description="Enemy shooting action - checks line of sight">
				<![CDATA[
-- WL_ACT2.C:T_Shoot (lines 4150-4218)
-- Attempt to shoot the player based on line of sight and distance

-- WL_ACT2.C:4157-4158 - Check if player is in the same area
-- (skipped - assume player is always reachable for now)

-- WL_ACT2.C:4160-4168 - Check line of sight
if not CheckLine() then
	-- Player is behind a wall, can't shoot
	return
end

-- WL_ACT2.C:4171-4173 - Calculate distance to player
local dx = GetPlayerTileX() - GetTileX()
local dy = GetPlayerTileY() - GetTileY()
if dx < 0 then dx = -dx end
if dy < 0 then dy = -dy end
local dist = dx
if dy > dx then dist = dy end

-- WL_ACT2.C:4177-4179 - SS and bosses are better shots (2/3 distance)
local actorType = GetActorType()
if actorType == "SS" or actorType == "Hans" then
	dist = (dist * 2) / 3
end

-- WL_ACT2.C:4181-4194 - Calculate hit chance based on distance and player speed
-- TODO: Check player speed when that's implemented
-- For now, assume player is moving and visible
local hitchance = 160 - (dist * 16)

-- WL_ACT2.C:4196-4210 - Roll for hit and calculate damage
if US_RndT() < hitchance then
	-- Hit! Calculate damage based on distance
	local damage = 0
	if dist < 2 then
		damage = US_RndT() / 4  -- Close range
	elseif dist < 4 then
		damage = US_RndT() / 8  -- Medium range
	else
		damage = US_RndT() / 16  -- Long range
	end

	DamagePlayer(damage)
end

-- WL_ACT2.C:4219-4256 - Play appropriate firing sound based on actor type
if actorType == "SS" then
	PlayLocalDigiSound("SSFIRESND")
elseif actorType == "Hans" then
	PlayLocalDigiSound("BOSSFIRESND")
else
	-- Guards, officers, and other enemies use NAZIFIRESND
	PlayLocalDigiSound("NAZIFIRESND")
end
]]>
			</Function>
			<Function Name="A_DeathScream" Description="Enemy death - score, item drops, death scream (WL_STATE.C:KillActor + WL_ACT2.C:A_DeathScream)">
				<![CDATA[
-- Combined KillActor (score + drops) and A_DeathScream (sound) logic
-- Both original functions switch on ob->obclass
local actorType = GetActorType()

if actorType == "Guard" then
	-- WL_STATE.C:KillActor - guardobj
	AddValue("Score", 100)
	PlaceItemType(71, 134)  -- bo_clip2 (4 ammo, not bo_clip's 8)
	-- WL_ACT2.C:A_DeathScream - random death scream
	local sounds = {"DEATHSCREAM1SND", "DEATHSCREAM2SND", "DEATHSCREAM3SND"}
	PlayLocalDigiSound(sounds[US_RndT() % 3 + 1])

elseif actorType == "Dog" then
	-- WL_STATE.C:KillActor - dogobj
	AddValue("Score", 200)
	-- No item drop
	PlayLocalDigiSound("DOGDEATHSND")

elseif actorType == "SS" then
	-- WL_STATE.C:KillActor - ssobj
	AddValue("Score", 500)
	if GetValue("Weapon2") < 1 then
		PlaceItemType(50, 135)  -- bo_machinegun
	else
		PlaceItemType(71, 134)  -- bo_clip2
	end
	PlayLocalDigiSound("LEBENSND")

elseif actorType == "Hans" then
	-- WL_STATE.C:KillActor - bossobj
	AddValue("Score", 5000)
	PlaceItemType(43, 128)  -- bo_key1 (gold key)
	PlayLocalDigiSound("MUTTISND")
end
]]>
			</Function>
		</StatInfo>
	</VSwap>
	<Palette>
		<Color Hex="#000000"/>
		<Color Hex="#0000A8"/>
		<Color Hex="#00A800"/>
		<Color Hex="#00A8A8"/>
		<Color Hex="#A80000"/>
		<Color Hex="#A800A8"/>
		<Color Hex="#A85400"/>
		<Color Hex="#A8A8A8"/>
		<Color Hex="#545454"/>
		<Color Hex="#5454FC"/>
		<Color Hex="#54FC54"/>
		<Color Hex="#54FCFC"/>
		<Color Hex="#FC5454"/>
		<Color Hex="#FC54FC"/>
		<Color Hex="#FCFC54"/>
		<Color Hex="#FCFCFC"/>
		<Color Hex="#ECECEC"/>
		<Color Hex="#DCDCDC"/>
		<Color Hex="#D0D0D0"/>
		<Color Hex="#C0C0C0"/>
		<Color Hex="#B4B4B4"/>
		<Color Hex="#A8A8A8"/>
		<Color Hex="#989898"/>
		<Color Hex="#8C8C8C"/>
		<Color Hex="#7C7C7C"/>
		<Color Hex="#707070"/>
		<Color Hex="#646464"/>
		<Color Hex="#545454"/>
		<Color Hex="#484848"/>
		<Color Hex="#383838"/>
		<Color Hex="#2C2C2C"/>
		<Color Hex="#202020"/>
		<Color Hex="#FC0000"/>
		<Color Hex="#EC0000"/>
		<Color Hex="#E00000"/>
		<Color Hex="#D40000"/>
		<Color Hex="#C80000"/>
		<Color Hex="#BC0000"/>
		<Color Hex="#B00000"/>
		<Color Hex="#A40000"/>
		<Color Hex="#980000"/>
		<Color Hex="#880000"/>
		<Color Hex="#7C0000"/>
		<Color Hex="#700000"/>
		<Color Hex="#640000"/>
		<Color Hex="#580000"/>
		<Color Hex="#4C0000"/>
		<Color Hex="#400000"/>
		<Color Hex="#FCD8D8"/>
		<Color Hex="#FCB8B8"/>
		<Color Hex="#FC9C9C"/>
		<Color Hex="#FC7C7C"/>
		<Color Hex="#FC5C5C"/>
		<Color Hex="#FC4040"/>
		<Color Hex="#FC2020"/>
		<Color Hex="#FC0000"/>
		<Color Hex="#FCA85C"/>
		<Color Hex="#FC9840"/>
		<Color Hex="#FC8820"/>
		<Color Hex="#FC7800"/>
		<Color Hex="#E46C00"/>
		<Color Hex="#CC6000"/>
		<Color Hex="#B45400"/>
		<Color Hex="#9C4C00"/>
		<Color Hex="#FCFCD8"/>
		<Color Hex="#FCFCB8"/>
		<Color Hex="#FCFC9C"/>
		<Color Hex="#FCFC7C"/>
		<Color Hex="#FCF85C"/>
		<Color Hex="#FCF440"/>
		<Color Hex="#FCF420"/>
		<Color Hex="#FCF400"/>
		<Color Hex="#E4D800"/>
		<Color Hex="#CCC400"/>
		<Color Hex="#B4AC00"/>
		<Color Hex="#9C9C00"/>
		<Color Hex="#848400"/>
		<Color Hex="#706C00"/>
		<Color Hex="#585400"/>
		<Color Hex="#404000"/>
		<Color Hex="#D0FC5C"/>
		<Color Hex="#C4FC40"/>
		<Color Hex="#B4FC20"/>
		<Color Hex="#A0FC00"/>
		<Color Hex="#90E400"/>
		<Color Hex="#80CC00"/>
		<Color Hex="#74B400"/>
		<Color Hex="#609C00"/>
		<Color Hex="#D8FCD8"/>
		<Color Hex="#BCFCB8"/>
		<Color Hex="#9CFC9C"/>
		<Color Hex="#80FC7C"/>
		<Color Hex="#60FC5C"/>
		<Color Hex="#40FC40"/>
		<Color Hex="#20FC20"/>
		<Color Hex="#00FC00"/>
		<Color Hex="#00FC00"/>
		<Color Hex="#00EC00"/>
		<Color Hex="#00E000"/>
		<Color Hex="#00D400"/>
		<Color Hex="#04C800"/>
		<Color Hex="#04BC00"/>
		<Color Hex="#04B000"/>
		<Color Hex="#04A400"/>
		<Color Hex="#049800"/>
		<Color Hex="#048800"/>
		<Color Hex="#047C00"/>
		<Color Hex="#047000"/>
		<Color Hex="#046400"/>
		<Color Hex="#045800"/>
		<Color Hex="#044C00"/>
		<Color Hex="#044000"/>
		<Color Hex="#D8FCFC"/>
		<Color Hex="#B8FCFC"/>
		<Color Hex="#9CFCFC"/>
		<Color Hex="#7CFCF8"/>
		<Color Hex="#5CFCFC"/>
		<Color Hex="#40FCFC"/>
		<Color Hex="#20FCFC"/>
		<Color Hex="#00FCFC"/>
		<Color Hex="#00E4E4"/>
		<Color Hex="#00CCCC"/>
		<Color Hex="#00B4B4"/>
		<Color Hex="#009C9C"/>
		<Color Hex="#008484"/>
		<Color Hex="#007070"/>
		<Color Hex="#005858"/>
		<Color Hex="#004040"/>
		<Color Hex="#5CBCFC"/>
		<Color Hex="#40B0FC"/>
		<Color Hex="#20A8FC"/>
		<Color Hex="#009CFC"/>
		<Color Hex="#008CE4"/>
		<Color Hex="#007CCC"/>
		<Color Hex="#006CB4"/>
		<Color Hex="#005C9C"/>
		<Color Hex="#D8D8FC"/>
		<Color Hex="#B8BCFC"/>
		<Color Hex="#9C9CFC"/>
		<Color Hex="#7C80FC"/>
		<Color Hex="#5C60FC"/>
		<Color Hex="#4040FC"/>
		<Color Hex="#2024FC"/>
		<Color Hex="#0004FC"/>
		<Color Hex="#0000FC"/>
		<Color Hex="#0000EC"/>
		<Color Hex="#0000E0"/>
		<Color Hex="#0000D4"/>
		<Color Hex="#0000C8"/>
		<Color Hex="#0000BC"/>
		<Color Hex="#0000B0"/>
		<Color Hex="#0000A4"/>
		<Color Hex="#000098"/>
		<Color Hex="#000088"/>
		<Color Hex="#00007C"/>
		<Color Hex="#000070"/>
		<Color Hex="#000064"/>
		<Color Hex="#000058"/>
		<Color Hex="#00004C"/>
		<Color Hex="#000040"/>
		<Color Hex="#282828"/>
		<Color Hex="#FCE034"/>
		<Color Hex="#FCD424"/>
		<Color Hex="#FCCC18"/>
		<Color Hex="#FCC008"/>
		<Color Hex="#FCB400"/>
		<Color Hex="#B420FC"/>
		<Color Hex="#A800FC"/>
		<Color Hex="#9800E4"/>
		<Color Hex="#8000CC"/>
		<Color Hex="#7400B4"/>
		<Color Hex="#60009C"/>
		<Color Hex="#500084"/>
		<Color Hex="#440070"/>
		<Color Hex="#340058"/>
		<Color Hex="#280040"/>
		<Color Hex="#FCD8FC"/>
		<Color Hex="#FCB8FC"/>
		<Color Hex="#FC9CFC"/>
		<Color Hex="#FC7CFC"/>
		<Color Hex="#FC5CFC"/>
		<Color Hex="#FC40FC"/>
		<Color Hex="#FC20FC"/>
		<Color Hex="#FC00FC"/>
		<Color Hex="#E000E4"/>
		<Color Hex="#C800CC"/>
		<Color Hex="#B400B4"/>
		<Color Hex="#9C009C"/>
		<Color Hex="#840084"/>
		<Color Hex="#6C0070"/>
		<Color Hex="#580058"/>
		<Color Hex="#400040"/>
		<Color Hex="#FCE8DC"/>
		<Color Hex="#FCE0D0"/>
		<Color Hex="#FCD8C4"/>
		<Color Hex="#FCD4BC"/>
		<Color Hex="#FCCCB0"/>
		<Color Hex="#FCC4A4"/>
		<Color Hex="#FCBC9C"/>
		<Color Hex="#FCB890"/>
		<Color Hex="#FCB080"/>
		<Color Hex="#FCA470"/>
		<Color Hex="#FC9C60"/>
		<Color Hex="#F0945C"/>
		<Color Hex="#E88C58"/>
		<Color Hex="#DC8854"/>
		<Color Hex="#D08050"/>
		<Color Hex="#C87C4C"/>
		<Color Hex="#BC7848"/>
		<Color Hex="#B47044"/>
		<Color Hex="#A86840"/>
		<Color Hex="#A0643C"/>
		<Color Hex="#9C6038"/>
		<Color Hex="#905C34"/>
		<Color Hex="#885830"/>
		<Color Hex="#80502C"/>
		<Color Hex="#744C28"/>
		<Color Hex="#6C4824"/>
		<Color Hex="#5C4020"/>
		<Color Hex="#543C1C"/>
		<Color Hex="#483818"/>
		<Color Hex="#403018"/>
		<Color Hex="#382C14"/>
		<Color Hex="#28200C"/>
		<Color Hex="#600064"/>
		<Color Hex="#006464"/>
		<Color Hex="#006060"/>
		<Color Hex="#00001C"/>
		<Color Hex="#00002C"/>
		<Color Hex="#302410"/>
		<Color Hex="#480048"/>
		<Color Hex="#500050"/>
		<Color Hex="#000034"/>
		<Color Hex="#1C1C1C"/>
		<Color Hex="#4C4C4C"/>
		<Color Hex="#5C5C5C"/>
		<Color Hex="#404040"/>
		<Color Hex="#303030"/>
		<Color Hex="#343434"/>
		<Color Hex="#D8F4F4"/>
		<Color Hex="#B8E8E8"/>
		<Color Hex="#9CDCDC"/>
		<Color Hex="#74C8C8"/>
		<Color Hex="#48C0C0"/>
		<Color Hex="#20B4B4"/>
		<Color Hex="#20B0B0"/>
		<Color Hex="#00A4A4"/>
		<Color Hex="#009898"/>
		<Color Hex="#008C8C"/>
		<Color Hex="#008484"/>
		<Color Hex="#007C7C"/>
		<Color Hex="#007878"/>
		<Color Hex="#007474"/>
		<Color Hex="#007070"/>
		<Color Hex="#006C6C"/>
		<Color Hex="#980088"/>
	</Palette>
</Game>
